\section{\texttt{LICENSE}}
\begin{verbatim}
Copyright (c)2011, Daniel Wagner

All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.

    * Redistributions in binary form must reproduce the above
      copyright notice, this list of conditions and the following
      disclaimer in the documentation and/or other materials provided
      with the distribution.

    * Neither the name of Daniel Wagner nor the names of other
      contributors may be used to endorse or promote products derived
      from this software without specific prior written permission.

! This software is provided by the copyright holders and contributors
! "as is" and any express or implied warranties, including, but not
! limited to, the implied warranties of merchantability and fitness for
! a particular purpose are disclaimed. In no event shall the copyright
! owner or contributors be liable for any direct, indirect, incidental,
! special, exemplary, or consequential damages (including, but not
! limited to, procurement of substitute goods or services; loss of use,
! data, or profits; or business interruption) however caused and on any
! theory of liability, whether in contract, strict liability, or tort
! (including negligence or otherwise) arising in any way out of the use
! of this software, even if advised of the possibility of such damage.

\end{verbatim}

\section{\texttt{demos/edit-lenses-demo.cabal}}
\begin{verbatim}
name:                edit-lenses-demo
version:             0.1
synopsis:            Programs demoing the use of symmetric, stateful edit lenses
Description:         Some simple demo programs showing ways to use the edit-lenses package.
-- Homepage:            http://dmwit.com/edit-lenses
license:             BSD3
license-file:        LICENSE
author:              Daniel Wagner
maintainer:          daniel@wagner-home.com
category:            Data
build-type:          Simple
cabal-version:       >=1.8

flag gtk
    description: Build demos that require a GUI.
    default: False

executable lens-editor
  if flag(gtk)
    build-depends:
      base >= 3.0 && < 5,
      containers >= 0.4,
      data-default >= 0.3,
      Diff >= 0.1 && < 0.2,
      edit-lenses >= 0.2,
      gtk >= 0.12,
      regex-pcre >= 0.94
    extensions: GeneralizedNewtypeDeriving
    other-modules: Data.Lens.Edit.String Data.Module.String
    main-is: lens-editor.hs
  else
    build-depends: base >= 3.0 && < 5
    main-is: no-gtk.hs

\end{verbatim}

\section{\texttt{demos/lens-editor.hs}}
\label{mod:lens-editor}
\textcolor{blue}{{\it{}\{-\# LANGUAGE GeneralizedNewtypeDeriving \#-\}}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Control}\textcolor{cyan}{.}{\rm{}Concurrent}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Control}\textcolor{cyan}{.}{\rm{}Monad}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}IORef}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}String}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Maybe}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\hsspace {\rm{}hiding}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\textcolor{cyan}{,}\hsspace {\rm{}Insert}\textcolor{cyan}{)}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}String}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Graphics}\textcolor{cyan}{.}{\rm{}UI}\textcolor{cyan}{.}{\rm{}Gtk}\\\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}DATE}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}DATE}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}()}\hsspace \textcolor{green}{\underline{deriving}}\hsspace {\rm{}Default}\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}COUNTRY}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}COUNTRY}\hsspace \hsspace \hsspace {\rm{}()}\hsspace \textcolor{green}{\underline{deriving}}\hsspace {\rm{}Default}\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}COMMA}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}COMMA}\hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}()}\hsspace \textcolor{green}{\underline{deriving}}\hsspace {\rm{}Default}\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}SEMICOLON}\hsspace \textcolor{red}{=}\hsspace {\rm{}SEMICOLON}\hsspace {\rm{}()}\hsspace \textcolor{green}{\underline{deriving}}\hsspace {\rm{}Default}\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}NEWLINE}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}NEWLINE}\hsspace \hsspace \hsspace {\rm{}()}\hsspace \textcolor{green}{\underline{deriving}}\hsspace {\rm{}Default}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Show}\hsspace {\rm{}DATE}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}show}\hsspace {\rm{}DATE}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{red}{=}\hsspace \textcolor{magenta}{``0000''}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Show}\hsspace {\rm{}COUNTRY}\hsspace \hsspace \hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}show}\hsspace {\rm{}COUNTRY}\hsspace \hsspace \hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{red}{=}\hsspace \textcolor{magenta}{``Unknown''}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Show}\hsspace {\rm{}COMMA}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}show}\hsspace {\rm{}COMMA}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{red}{=}\hsspace \textcolor{magenta}{``,''}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Show}\hsspace {\rm{}SEMICOLON}\hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}show}\hsspace {\rm{}SEMICOLON}\hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{red}{=}\hsspace \textcolor{magenta}{``;''}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Show}\hsspace {\rm{}NEWLINE}\hsspace \hsspace \hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}show}\hsspace {\rm{}NEWLINE}\hsspace \hsspace \hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{red}{=}\hsspace \textcolor{magenta}{``$\backslash$n''}\\\\\textcolor{blue}{commaToSemicolon}\hsspace \textcolor{red}{=}\hsspace {\rm{}skipNonEmpty}\hsspace {\rm{}COMMA}\hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{magenta}{``,''}\hsspace \textcolor{magenta}{\#}\hsspace {\rm{}op}\hsspace \textcolor{cyan}{(}{\rm{}skipNonEmpty}\hsspace {\rm{}SEMICOLON}\hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{magenta}{``;''}\textcolor{cyan}{)}\\\textcolor{blue}{composerName}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}copyEmpty}\hsspace \textcolor{magenta}{``[\ensuremath{\hat{ }},;$\backslash$n]*''}\\\textcolor{blue}{composerYear}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}skipNonEmpty}\hsspace {\rm{}DATE}\hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{magenta}{``$\backslash$$\backslash$d$\backslash$$\backslash$d$\backslash$$\backslash$d$\backslash$$\backslash$d''}\\\textcolor{blue}{composerCountry}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}op}\hsspace \textcolor{cyan}{(}{\rm{}skipNonEmpty}\hsspace {\rm{}COUNTRY}\hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{magenta}{``[A-Z][\ensuremath{\hat{ }}$\backslash$n]*''}\textcolor{cyan}{)}\\\textcolor{blue}{newline}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}copyNonEmpty}\hsspace {\rm{}NEWLINE}\hsspace \textcolor{cyan}{\{}\textcolor{cyan}{\}}\hsspace \textcolor{magenta}{``$\backslash$n''}\\\textcolor{cyan}{(}{\rm{}leftM}\textcolor{cyan}{,}\hsspace {\rm{}lens}\textcolor{cyan}{,}\hsspace {\rm{}rightM}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}star}\hsspace \textcolor{cyan}{(}{\rm{}composerName}\hsspace \textcolor{magenta}{\#}\hsspace {\rm{}commaToSemicolon}\hsspace \textcolor{magenta}{\#}\hsspace {\rm{}composerYear}\hsspace \textcolor{magenta}{\#}\hsspace {\rm{}composerCountry}\hsspace \textcolor{magenta}{\#}\hsspace {\rm{}newline}\textcolor{cyan}{)}\\\\\textcolor{blue}{initView}\hsspace {\rm{}string}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{do}}\\\hstab {\rm{}buffer}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}textBufferNew}\hsspace {\rm{}Nothing}\\\hstab {\rm{}view}\hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}textViewNewWithBuffer}\hsspace {\rm{}buffer}\\\hstab {\rm{}good}\hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}newIORef}\hsspace \textcolor{cyan}{(}{\rm{}def}\textcolor{cyan}{,}\hsspace {\rm{}[]}\textcolor{cyan}{)}\\\hstab {\rm{}del}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}newIORef}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace \textcolor{magenta}{0}\hsspace \textcolor{magenta}{0}\textcolor{cyan}{)}\\\hstab {\rm{}sigm}\hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}newEmptyMVar}\\\hstab {\rm{}font}\hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}fontDescriptionNew}\\\hstab {\rm{}fontDescriptionSetSize}\hsspace {\rm{}font}\hsspace \textcolor{magenta}{48}\\\hstab {\rm{}widgetModifyFont}\hsspace {\rm{}view}\hsspace \textcolor{cyan}{(}{\rm{}Just}\hsspace {\rm{}font}\textcolor{cyan}{)}\\\hstab {\rm{}readIORef}\hsspace {\rm{}good}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}textBufferInsertAtCursor}\hsspace {\rm{}buffer}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}pprint}\hsspace {\rm{}string}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}fst}\\\hstab {\rm{}return}\hsspace \textcolor{cyan}{(}{\rm{}buffer}\textcolor{cyan}{,}\hsspace {\rm{}view}\textcolor{cyan}{,}\hsspace {\rm{}good}\textcolor{cyan}{,}\hsspace {\rm{}del}\textcolor{cyan}{,}\hsspace {\rm{}sigm}\textcolor{cyan}{)}\\\\\textcolor{blue}{changeEvent}\hsspace {\rm{}cref}\hsspace {\rm{}sigm}\hsspace {\rm{}this}\hsspace {\rm{}that}\hsspace {\rm{}goodThis}\hsspace {\rm{}goodThat}\hsspace {\rm{}dput}\hsspace {\rm{}stringThis}\hsspace {\rm{}stringThat}\hsspace {\rm{}e}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{do}}\\\hstab {\rm{}c}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}readIORef}\hsspace {\rm{}cref}\\\hstab \textcolor{cyan}{(}{\rm{}oldThis}\textcolor{cyan}{,}\hsspace {\rm{}es}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}readIORef}\hsspace {\rm{}goodThis}\\\hstab \textcolor{cyan}{(}{\rm{}oldThat}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}readIORef}\hsspace {\rm{}goodThat}\\\hstab {\rm{}newThisS}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}get}\hsspace {\rm{}this}\hsspace {\rm{}textBufferText}\\\hstab {\rm{}sigs}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}readMVar}\hsspace {\rm{}sigm}\\\hstab {\rm{}mapM\_}\hsspace {\rm{}signalBlock}\hsspace {\rm{}sigs}\\\hstab \textcolor{green}{\underline{case}}\hsspace {\rm{}parse}\hsspace {\rm{}stringThis}\hsspace {\rm{}newThisS}\hsspace \textcolor{green}{\underline{of}}\\\hstab \hstab {\rm{}Nothing}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}writeIORef}\hsspace {\rm{}goodThis}\hsspace \textcolor{cyan}{(}{\rm{}oldThis}\textcolor{cyan}{,}\hsspace {\rm{}e}\textcolor{red}{{\bf{}:}}{\rm{}es}\textcolor{cyan}{)}\\\hstab \hstab {\rm{}Just}\hsspace {\rm{}newThis}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{do}}\\\hstab \hstab \hstab \textcolor{green}{\underline{let}}\hsspace {\rm{}eThis}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}edit}\hsspace {\rm{}stringThis}\hsspace {\rm{}oldThis}\hsspace \textcolor{cyan}{(}{\rm{}e}\textcolor{red}{{\bf{}:}}{\rm{}es}\textcolor{cyan}{)}\\\hstab \hstab \hstab \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}eThat}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}dput}\hsspace {\rm{}lens}\hsspace \textcolor{cyan}{(}{\rm{}edit}\hsspace {\rm{}stringThis}\hsspace {\rm{}oldThis}\hsspace \textcolor{cyan}{(}{\rm{}e}\textcolor{red}{{\bf{}:}}{\rm{}es}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \hstab \hstab \hsspace \hsspace \hsspace \hsspace {\rm{}Just}\hsspace {\rm{}newThat}\hsspace \textcolor{red}{=}\hsspace {\rm{}apply}\hsspace {\rm{}eThat}\hsspace {\rm{}oldThat}\\\hstab \hstab \hstab {\rm{}putStrLn}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{magenta}{``Edit received: ''}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}show}\hsspace {\rm{}eThis}\\\hstab \hstab \hstab {\rm{}putStrLn}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{magenta}{``Lens computes: ''}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}show}\hsspace {\rm{}eThat}\\\hstab \hstab \hstab {\rm{}writeIORef}\hsspace {\rm{}cref}\hsspace {\rm{}c'}\\\hstab \hstab \hstab {\rm{}writeIORef}\hsspace {\rm{}goodThis}\hsspace \textcolor{cyan}{(}{\rm{}newThis}\textcolor{cyan}{,}\hsspace {\rm{}[]}\textcolor{cyan}{)}\\\hstab \hstab \hstab {\rm{}writeIORef}\hsspace {\rm{}goodThat}\hsspace \textcolor{cyan}{(}{\rm{}newThat}\textcolor{cyan}{,}\hsspace {\rm{}[]}\textcolor{cyan}{)}\\\hstab \hstab \hstab {\rm{}set}\hsspace {\rm{}that}\hsspace \textcolor{red}{[}\hsspace {\rm{}textBufferText}\hsspace \textcolor{red}{{\bf{}:=}}\hsspace {\rm{}pprint}\hsspace {\rm{}stringThat}\hsspace {\rm{}newThat}\hsspace \textcolor{red}{]}\\\hstab {\rm{}mapM\_}\hsspace {\rm{}signalUnblock}\hsspace {\rm{}sigs}\\\\\textcolor{blue}{changeEventL}\hsspace {\rm{}cref}\hsspace \textcolor{cyan}{(}{\rm{}buf1}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}good1}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}buf2}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}good2}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}sigm2}\textcolor{cyan}{)}\\\hstab \textcolor{red}{=}\hsspace {\rm{}changeEvent}\hsspace {\rm{}cref}\hsspace {\rm{}sigm2}\hsspace {\rm{}buf1}\hsspace {\rm{}buf2}\hsspace {\rm{}good1}\hsspace {\rm{}good2}\hsspace {\rm{}dputr}\hsspace {\rm{}leftM}\hsspace {\rm{}rightM}\\\textcolor{blue}{changeEventR}\hsspace {\rm{}cref}\hsspace \textcolor{cyan}{(}{\rm{}buf1}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}good1}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}sigm1}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}buf2}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}good2}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{)}\\\hstab \textcolor{red}{=}\hsspace {\rm{}changeEvent}\hsspace {\rm{}cref}\hsspace {\rm{}sigm1}\hsspace {\rm{}buf2}\hsspace {\rm{}buf1}\hsspace {\rm{}good2}\hsspace {\rm{}good1}\hsspace {\rm{}dputl}\hsspace {\rm{}rightM}\hsspace {\rm{}leftM}\\\\\textcolor{blue}{insertEdit}\hsspace {\rm{}p}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}get}\hsspace {\rm{}p}\hsspace {\rm{}textIterOffset}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace \textcolor{red}{$\backslash$}{\rm{}n}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}return}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace \textcolor{cyan}{(}{\rm{}n}\hsspace \textcolor{blue}{{\it{}-}}\hsspace {\rm{}length}\hsspace {\rm{}s}\textcolor{cyan}{)}\hsspace {\rm{}s}\textcolor{cyan}{)}\\\textcolor{blue}{deleteEdit}\hsspace {\rm{}p}\hsspace {\rm{}p'}\hsspace \textcolor{red}{=}\hsspace {\rm{}liftM2}\hsspace {\rm{}Delete}\hsspace \textcolor{cyan}{(}{\rm{}get}\hsspace {\rm{}p}\hsspace {\rm{}textIterOffset}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}get}\hsspace {\rm{}p'}\hsspace {\rm{}textIterOffset}\textcolor{cyan}{)}\\\\\textcolor{blue}{main}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{do}}\\\hstab {\rm{}initGUI}\\\hstab {\rm{}window}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}windowNew}\\\hstab {\rm{}hbox}\hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}hBoxNew}\hsspace {\rm{}False}\hsspace \textcolor{magenta}{2}\\\hstab {\rm{}cref}\hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}newIORef}\hsspace \textcolor{cyan}{(}{\rm{}missing}\hsspace {\rm{}lens}\textcolor{cyan}{)}\\\hstab {\rm{}v1}\textcolor{red}{@}\textcolor{cyan}{(}{\rm{}buf1}\textcolor{cyan}{,}\hsspace {\rm{}view1}\textcolor{cyan}{,}\hsspace {\rm{}good1}\textcolor{cyan}{,}\hsspace {\rm{}del1}\textcolor{cyan}{,}\hsspace {\rm{}sigm1}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}initView}\hsspace {\rm{}leftM}\\\hstab {\rm{}v2}\textcolor{red}{@}\textcolor{cyan}{(}{\rm{}buf2}\textcolor{cyan}{,}\hsspace {\rm{}view2}\textcolor{cyan}{,}\hsspace {\rm{}good2}\textcolor{cyan}{,}\hsspace {\rm{}del2}\textcolor{cyan}{,}\hsspace {\rm{}sigm2}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}initView}\hsspace {\rm{}rightM}\\\\\hstab {\rm{}window}\hsspace \textcolor{cyan}{`on`}\hsspace {\rm{}objectDestroy}\hsspace \textcolor{cyan}{\$}\hsspace {\rm{}mainQuit}\\\hstab {\rm{}sig1i}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}buf1}\hsspace \textcolor{cyan}{`after`}\hsspace {\rm{}bufferInsertText}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{red}{$\backslash$}{\rm{}p}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}insertEdit}\hsspace {\rm{}p}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}changeEventL}\hsspace {\rm{}cref}\hsspace {\rm{}v1}\hsspace {\rm{}v2}\\\hstab {\rm{}sig1w}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}buf1}\hsspace \textcolor{cyan}{`on`}\hsspace \hsspace \hsspace \hsspace {\rm{}deleteRange}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{\$}\hsspace \textcolor{red}{$\backslash$}{\rm{}p}\hsspace {\rm{}p'}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}deleteEdit}\hsspace {\rm{}p}\hsspace {\rm{}p'}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}writeIORef}\hsspace {\rm{}del1}\\\hstab {\rm{}sig1r}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}buf1}\hsspace \textcolor{cyan}{`after`}\hsspace {\rm{}deleteRange}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{\$}\hsspace \textcolor{red}{$\backslash$}{\rm{}p}\hsspace {\rm{}p'}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}readIORef}\hsspace \hsspace {\rm{}del1}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}changeEventL}\hsspace {\rm{}cref}\hsspace {\rm{}v1}\hsspace {\rm{}v2}\\\hstab {\rm{}sig2i}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}buf2}\hsspace \textcolor{cyan}{`after`}\hsspace {\rm{}bufferInsertText}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{red}{$\backslash$}{\rm{}p}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}insertEdit}\hsspace {\rm{}p}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}changeEventR}\hsspace {\rm{}cref}\hsspace {\rm{}v1}\hsspace {\rm{}v2}\\\hstab {\rm{}sig2w}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}buf2}\hsspace \textcolor{cyan}{`on`}\hsspace \hsspace \hsspace \hsspace {\rm{}deleteRange}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{\$}\hsspace \textcolor{red}{$\backslash$}{\rm{}p}\hsspace {\rm{}p'}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}deleteEdit}\hsspace {\rm{}p}\hsspace {\rm{}p'}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}writeIORef}\hsspace {\rm{}del2}\\\hstab {\rm{}sig2r}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}buf2}\hsspace \textcolor{cyan}{`after`}\hsspace {\rm{}deleteRange}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{\$}\hsspace \textcolor{red}{$\backslash$}{\rm{}p}\hsspace {\rm{}p'}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}readIORef}\hsspace \hsspace {\rm{}del2}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}changeEventR}\hsspace {\rm{}cref}\hsspace {\rm{}v1}\hsspace {\rm{}v2}\\\hstab {\rm{}putMVar}\hsspace {\rm{}sigm1}\hsspace \textcolor{red}{[}{\rm{}sig1i}\textcolor{cyan}{,}\hsspace {\rm{}sig1w}\textcolor{cyan}{,}\hsspace {\rm{}sig1r}\textcolor{red}{]}\\\hstab {\rm{}putMVar}\hsspace {\rm{}sigm2}\hsspace \textcolor{red}{[}{\rm{}sig2i}\textcolor{cyan}{,}\hsspace {\rm{}sig2w}\textcolor{cyan}{,}\hsspace {\rm{}sig2r}\textcolor{red}{]}\\\\\hstab {\rm{}set}\hsspace {\rm{}window}\hsspace \textcolor{red}{[}\hsspace {\rm{}containerChild}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{{\bf{}:=}}\hsspace {\rm{}hbox}\\\hstab \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{,}\hsspace {\rm{}windowDefaultWidth}\hsspace \hsspace \textcolor{red}{{\bf{}:=}}\hsspace \textcolor{magenta}{600}\\\hstab \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{,}\hsspace {\rm{}windowDefaultHeight}\hsspace \textcolor{red}{{\bf{}:=}}\hsspace \textcolor{magenta}{200}\\\hstab \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{]}\\\hstab {\rm{}set}\hsspace {\rm{}hbox}\hsspace \hsspace \hsspace \textcolor{red}{[}\hsspace {\rm{}containerChild}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{{\bf{}:=}}\hsspace {\rm{}view1}\\\hstab \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{,}\hsspace {\rm{}containerChild}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{{\bf{}:=}}\hsspace {\rm{}view2}\\\hstab \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{]}\\\\\hstab {\rm{}widgetShowAll}\hsspace {\rm{}window}\\\hstab {\rm{}mainGUI}\\
\section{\texttt{demos/no-gtk.hs}}
\label{mod:no-gtk}
\textcolor{blue}{main}\hsspace \textcolor{red}{=}\hsspace {\rm{}putStrLn}\hsspace \textcolor{magenta}{``This executable was disabled at compile time to avoid a dependency on Gtk+. To$\backslash$nenable, add $\backslash$"--flags=gtk$\backslash$" to cabal's configure or install command.''}\\
\section{\texttt{demos/Data/Lens/Edit/String.hs}}
\label{mod:Data.Lens.Edit.String}
\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}String}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Container}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Primitive}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Product}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}String}\\\\\textcolor{blue}{copyEmpty}\hsspace \textcolor{red}{::}\hsspace {\rm{}String}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}Match}\textcolor{cyan}{,}\hsspace {\rm{}Id}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Match}\textcolor{cyan}{)}\\\textcolor{blue}{copyEmpty}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}Match}\hsspace {\rm{}s}\textcolor{cyan}{,}\hsspace {\rm{}Id}\textcolor{cyan}{,}\hsspace {\rm{}Match}\hsspace {\rm{}s}\textcolor{cyan}{)}\\\\\textcolor{blue}{copyNonEmpty}\hsspace \textcolor{red}{::}\hsspace {\rm{}v}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}String}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultMatch}\hsspace {\rm{}v}\textcolor{cyan}{,}\hsspace {\rm{}Id}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultModule}\hsspace {\rm{}v}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}NewDefaultMatch}\hsspace {\rm{}v}\textcolor{cyan}{)}\\\textcolor{blue}{copyNonEmpty}\hsspace {\rm{}v}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultMatch}\hsspace {\rm{}s}\textcolor{cyan}{,}\hsspace {\rm{}Id}\textcolor{cyan}{,}\hsspace {\rm{}NewDefaultMatch}\hsspace {\rm{}s}\textcolor{cyan}{)}\\\\\textcolor{blue}{skipEmpty}\hsspace \textcolor{red}{::}\hsspace {\rm{}String}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}Match}\textcolor{cyan}{,}\hsspace {\rm{}Disconnect}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Match}\textcolor{cyan}{)}\\\textcolor{blue}{skipEmpty}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}Match}\hsspace {\rm{}s}\textcolor{cyan}{,}\hsspace {\rm{}Disconnect}\textcolor{cyan}{,}\hsspace {\rm{}Match}\hsspace \textcolor{magenta}{``''}\textcolor{cyan}{)}\\\\\textcolor{blue}{skipNonEmpty}\hsspace \textcolor{red}{::}\hsspace {\rm{}v}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}String}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultMatch}\hsspace {\rm{}v}\textcolor{cyan}{,}\hsspace {\rm{}Disconnect}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultModule}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Match}\textcolor{cyan}{)}\\\textcolor{blue}{skipNonEmpty}\hsspace {\rm{}v}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultMatch}\hsspace {\rm{}s}\textcolor{cyan}{,}\hsspace {\rm{}Disconnect}\textcolor{cyan}{,}\hsspace {\rm{}Match}\hsspace \textcolor{magenta}{``''}\textcolor{cyan}{)}\\\\\textcolor{cyan}{(}\textcolor{magenta}{\#}\textcolor{cyan}{)}\hsspace \textcolor{red}{::}\hsspace \textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}c}\textcolor{cyan}{,}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}d}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}d}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\textcolor{cyan}{(}\textcolor{magenta}{\#}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}c}\textcolor{cyan}{,}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}d}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}d}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{op}\hsspace \textcolor{red}{::}\hsspace \textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}a}\textcolor{cyan}{)}\\\textcolor{blue}{op}\hsspace \textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}a}\textcolor{cyan}{)}\\\\\textcolor{blue}{star}\hsspace \textcolor{red}{::}\hsspace \textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}Asterisk}\hsspace {\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}Map}\hsspace {\rm{}Int}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}Asterisk}\hsspace {\rm{}b}\textcolor{cyan}{)}\\\textcolor{blue}{star}\hsspace \textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}Asterisk}\hsspace {\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}Asterisk}\hsspace {\rm{}b}\textcolor{cyan}{)}\\
\section{\texttt{demos/Data/Module/String.hs}}
\label{mod:Data.Module.String}
\textcolor{blue}{{\it{}\{-\# LANGUAGE FlexibleContexts, FlexibleInstances, GeneralizedNewtypeDeriving, ScopedTypeVariables, TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}String}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Control}\textcolor{cyan}{.}{\rm{}Arrow}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Control}\textcolor{cyan}{.}{\rm{}Monad}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Algorithm}\textcolor{cyan}{.}{\rm{}Diff}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}List}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Maybe}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Container}\hsspace \textcolor{cyan}{(}{\rm{}ContainerAtom}\textcolor{cyan}{)}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Product}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Shape}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Text}\textcolor{cyan}{.}{\rm{}Regex}\textcolor{cyan}{.}{\rm{}PCRE}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Map}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}M}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Container}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}C}\\\\\textcolor{green}{\underline{class}}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}M}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}StringModule}\hsspace {\rm{}m}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}M}\hsspace {\rm{}m}\\\hstab {\rm{}valid}\hsspace \hsspace \textcolor{red}{::}\hsspace {\rm{}m}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}String}\hsspace \textcolor{blue}{{\it{}-- returns a regex telling what strings are valid}}\\\hstab {\rm{}parse}\hsspace \hsspace \textcolor{red}{::}\hsspace {\rm{}m}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}String}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Maybe}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}M}\hsspace {\rm{}m}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}pprint}\hsspace \textcolor{red}{::}\hsspace {\rm{}m}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}M}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}String}\\\hstab {\rm{}edit}\hsspace \hsspace \hsspace \textcolor{red}{::}\hsspace {\rm{}m}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}M}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}M}\hsspace {\rm{}m}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Edit}\hsspace \textcolor{red}{=}\hsspace {\rm{}Insert}\hsspace {\rm{}Int}\hsspace {\rm{}String}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Delete}\hsspace {\rm{}Int}\hsspace {\rm{}Int}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}PartialEdit}\hsspace {\rm{}Edit}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V\_0}\hsspace {\rm{}Edit}\hsspace \textcolor{red}{=}\hsspace {\rm{}String}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace {\rm{}n}\hsspace {\rm{}s'}\textcolor{cyan}{)}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace \textcolor{cyan}{(}{\rm{}take}\hsspace {\rm{}n}\hsspace {\rm{}s}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}s'}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}drop}\hsspace {\rm{}n}\hsspace {\rm{}s}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}n}\hsspace {\rm{}n'}\textcolor{cyan}{)}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace \textcolor{cyan}{(}{\rm{}take}\hsspace {\rm{}n}\hsspace {\rm{}s}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}drop}\hsspace {\rm{}n'}\hsspace {\rm{}s}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}Match}\hsspace \textcolor{red}{=}\hsspace {\rm{}Match}\hsspace {\rm{}String}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{blue}{maybeMatch}\hsspace {\rm{}re}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace {\rm{}guard}\hsspace \textcolor{cyan}{(}{\rm{}s}\hsspace \textcolor{cyan}{=\tilde{ }}\hsspace {\rm{}re}\hsspace \textcolor{cyan}{==}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{0}\hsspace \textcolor{red}{::}\hsspace {\rm{}Int}\textcolor{cyan}{,}\hsspace {\rm{}length}\hsspace {\rm{}s}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}}\hsspace {\rm{}return}\hsspace {\rm{}s}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}StringModule}\hsspace {\rm{}Match}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}M}\hsspace {\rm{}Match}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\\\hstab {\rm{}valid}\hsspace \textcolor{cyan}{(}{\rm{}Match}\hsspace {\rm{}re}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}re}\\\hstab {\rm{}parse}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}maybeMatch}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}valid}\\\hstab {\rm{}pprint}\hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace {\rm{}id}\\\hstab {\rm{}edit}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace \textcolor{cyan}{(}{\rm{}const}\hsspace {\rm{}id}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}StringModule}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}StringModule}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}StringModule}\hsspace \textcolor{cyan}{(}{\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}M}\hsspace \textcolor{cyan}{(}{\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}M}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}M}\hsspace {\rm{}dY}\textcolor{cyan}{)}\\\hstab {\rm{}valid}\hsspace \textcolor{cyan}{(}{\rm{}mx}\textcolor{cyan}{,}\hsspace {\rm{}my}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}valid}\hsspace {\rm{}mx}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}valid}\hsspace {\rm{}my}\\\hstab {\rm{}parse}\hsspace \textcolor{cyan}{(}{\rm{}mx}\textcolor{cyan}{,}\hsspace {\rm{}my}\textcolor{cyan}{)}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{do}}\\\hstab \hstab \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}m}\hsspace \textcolor{cyan}{,}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}s}\hsspace \textcolor{cyan}{=\tilde{ }}\hsspace {\rm{}valid}\hsspace {\rm{}mx}\\\hstab \hstab \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}m'}\textcolor{cyan}{,}\hsspace {\rm{}n'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}drop}\hsspace {\rm{}n}\hsspace {\rm{}s}\hsspace \textcolor{cyan}{=\tilde{ }}\hsspace {\rm{}valid}\hsspace {\rm{}my}\\\hstab \hstab {\rm{}guard}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}m}\textcolor{cyan}{,}\hsspace {\rm{}m'}\textcolor{cyan}{,}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{+}\hsspace {\rm{}n'}\textcolor{red}{]}\hsspace \textcolor{cyan}{==}\hsspace \textcolor{red}{[}\textcolor{magenta}{0}\textcolor{cyan}{,}\hsspace \textcolor{magenta}{0}\textcolor{cyan}{,}\hsspace {\rm{}length}\hsspace {\rm{}s}\textcolor{red}{]}\textcolor{cyan}{)}\\\hstab \hstab {\rm{}vx}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}parse}\hsspace {\rm{}mx}\hsspace \textcolor{cyan}{(}{\rm{}take}\hsspace {\rm{}n}\hsspace {\rm{}s}\textcolor{cyan}{)}\\\hstab \hstab {\rm{}vy}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}parse}\hsspace {\rm{}my}\hsspace \textcolor{cyan}{(}{\rm{}drop}\hsspace {\rm{}n}\hsspace {\rm{}s}\textcolor{cyan}{)}\\\hstab \hstab {\rm{}return}\hsspace \textcolor{cyan}{(}{\rm{}vx}\textcolor{cyan}{,}\hsspace {\rm{}vy}\textcolor{cyan}{)}\\\hstab {\rm{}pprint}\hsspace \textcolor{cyan}{(}{\rm{}mx}\textcolor{cyan}{,}\hsspace {\rm{}my}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}vx}\textcolor{cyan}{,}\hsspace {\rm{}vy}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}pprint}\hsspace {\rm{}mx}\hsspace {\rm{}vx}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}pprint}\hsspace {\rm{}my}\hsspace {\rm{}vy}\\\hstab {\rm{}edit}\hsspace \textcolor{red}{=}\hsspace {\rm{}editProd}\\\\\textcolor{blue}{editProd}\hsspace \textcolor{cyan}{(}{\rm{}mx}\textcolor{cyan}{,}\hsspace {\rm{}my}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}vx}\textcolor{cyan}{,}\hsspace {\rm{}vy}\textcolor{cyan}{)}\hsspace {\rm{}es}\hsspace \textcolor{red}{=}\hsspace {\rm{}edit}\hsspace {\rm{}mx}\hsspace {\rm{}vx}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}edit}\hsspace {\rm{}my}\hsspace {\rm{}vy}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}splitMap}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}Nothing}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}replace}\hsspace {\rm{}sx}\hsspace {\rm{}sx'}\textcolor{cyan}{,}\hsspace {\rm{}replace}\hsspace {\rm{}sy}\hsspace {\rm{}sy'}\textcolor{cyan}{)}\\\hstab {\rm{}Just}\hsspace {\rm{}ms}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}exs}\textcolor{cyan}{,}\hsspace {\rm{}eys}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{where}}\\\hstab {\rm{}die}\hsspace \textcolor{red}{=}\hsspace {\rm{}error}\hsspace \textcolor{magenta}{``The impossible happened! A [Edit] didn't successfully apply to a String in editProd.''}\\\hstab {\rm{}sx}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}pprint}\hsspace {\rm{}mx}\hsspace {\rm{}vx}\\\hstab {\rm{}sy}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}pprint}\hsspace {\rm{}my}\hsspace {\rm{}vy}\\\hstab {\rm{}sn}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}fromMaybe}\hsspace {\rm{}die}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}es}\hsspace \textcolor{cyan}{(}{\rm{}sx}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}sy}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}oldSplit}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}length}\hsspace {\rm{}sx}\\\hstab {\rm{}newSplit}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}snd}\hsspace \textcolor{cyan}{(}{\rm{}sn}\hsspace \textcolor{cyan}{=\tilde{ }}\hsspace {\rm{}valid}\hsspace {\rm{}mx}\hsspace \textcolor{red}{::}\hsspace \textcolor{cyan}{(}{\rm{}Int}\textcolor{cyan}{,}\hsspace {\rm{}Int}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}{\rm{}sx'}\textcolor{cyan}{,}\hsspace {\rm{}sy'}\textcolor{cyan}{)}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}splitAt}\hsspace {\rm{}newSplit}\hsspace {\rm{}sn}\\\hstab {\rm{}easySplits}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}trackEdits}\hsspace \textcolor{red}{[}{\rm{}oldSplit}\textcolor{red}{]}\hsspace {\rm{}es}\\\hstab {\rm{}splitMap}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}lookup}\hsspace {\rm{}newSplit}\hsspace {\rm{}easySplits}\\\hstab \textcolor{blue}{{\it{}-- this is dangerous, only use the variables it binds when splitMap is definitely a Just!}}\\\hstab \textcolor{cyan}{(}{\rm{}exs}\textcolor{cyan}{,}\hsspace {\rm{}eys}\textcolor{cyan}{)}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}splitEdits}\hsspace \textcolor{cyan}{(}{\rm{}fromJust}\hsspace {\rm{}splitMap}\textcolor{cyan}{)}\hsspace {\rm{}oldSplit}\hsspace {\rm{}es}\\\hstab {\rm{}replace}\hsspace {\rm{}s}\hsspace {\rm{}s'}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}Insert}\hsspace \textcolor{magenta}{0}\hsspace {\rm{}s'}\textcolor{cyan}{,}\hsspace {\rm{}Delete}\hsspace \textcolor{magenta}{0}\hsspace \textcolor{cyan}{(}{\rm{}length}\hsspace {\rm{}s}\textcolor{cyan}{)}\textcolor{red}{]}\\\\\textcolor{blue}{trackEdit}\hsspace \textcolor{red}{::}\hsspace {\rm{}Edit}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}Int}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Map}\hsspace {\rm{}Int}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Map}\hsspace {\rm{}Int}\hsspace {\rm{}Int}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}Int}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Map}\hsspace {\rm{}Int}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Map}\hsspace {\rm{}Int}\hsspace {\rm{}Int}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\textcolor{blue}{trackEdit}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace {\rm{}n}\hsspace {\rm{}s}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{,}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}i}\hsspace \textcolor{cyan}{+}\hsspace \textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}m'}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{cyan}{(}{\rm{}smaller}\textcolor{cyan}{,}\hsspace {\rm{}larger'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}split}\hsspace {\rm{}n}\hsspace {\rm{}m}\\\hstab {\rm{}len}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}length}\hsspace {\rm{}s}\\\hstab {\rm{}larger}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}mapKeysMonotonic}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{+}\hsspace {\rm{}len}\textcolor{cyan}{)}\hsspace {\rm{}larger'}\\\hstab {\rm{}exact}\hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}lookup}\hsspace {\rm{}n}\hsspace {\rm{}m}\hsspace \textcolor{green}{\underline{of}}\\\hstab \hstab {\rm{}Nothing}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}empty}\\\hstab \hstab {\rm{}Just}\hsspace {\rm{}im}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}fromList}\hsspace \textcolor{red}{[}\textcolor{cyan}{(}{\rm{}n}\hsspace \textcolor{cyan}{+}\hsspace {\rm{}i'}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}insert}\hsspace {\rm{}i}\hsspace {\rm{}i'}\hsspace {\rm{}im}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}i'}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace \textcolor{red}{[}\textcolor{magenta}{0}\hsspace \textcolor{red}{..}\hsspace {\rm{}len}\textcolor{red}{]}\textcolor{red}{]}\\\hstab {\rm{}m'}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}smaller}\hsspace \textcolor{cyan}{`}{\rm{}M}\textcolor{cyan}{.}{\rm{}union}\textcolor{cyan}{`}\hsspace {\rm{}larger}\hsspace \textcolor{cyan}{`}{\rm{}M}\textcolor{cyan}{.}{\rm{}union}\textcolor{cyan}{`}\hsspace {\rm{}exact}\\\textcolor{blue}{trackEdit}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}n}\hsspace {\rm{}n'}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{,}\hsspace {\rm{}m}\textcolor{cyan}{)}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace \hsspace {\rm{}n'}\hsspace \textcolor{red}{=}\hsspace {\rm{}trackEdit}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}n'}\hsspace {\rm{}n}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{,}\hsspace {\rm{}m}\textcolor{cyan}{)}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{==}\hsspace {\rm{}n'}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}i}\hsspace \textcolor{cyan}{+}\hsspace \textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}m}\textcolor{cyan}{)}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{\ensuremath{\langle}}\hsspace \hsspace {\rm{}n'}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}i}\hsspace \textcolor{cyan}{+}\hsspace \textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}m'}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{cyan}{(}{\rm{}smaller}\textcolor{cyan}{,}\hsspace {\rm{}notSmaller}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}split}\hsspace \textcolor{cyan}{(}{\rm{}n}\hsspace \textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace {\rm{}m}\\\hstab \textcolor{cyan}{(}{\rm{}deleted}\textcolor{cyan}{,}\hsspace {\rm{}larger'}\textcolor{cyan}{)}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}split}\hsspace \textcolor{cyan}{(}{\rm{}n'}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace {\rm{}notSmaller}\\\hstab {\rm{}len}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}n'}\hsspace \textcolor{blue}{{\it{}-}}\hsspace {\rm{}n}\\\hstab {\rm{}larger}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}mapKeysMonotonic}\hsspace \textcolor{cyan}{(}{\rm{}subtract}\hsspace {\rm{}len}\textcolor{cyan}{)}\hsspace {\rm{}larger'}\\\hstab {\rm{}m'}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}smaller}\hsspace \textcolor{cyan}{`}{\rm{}M}\textcolor{cyan}{.}{\rm{}union}\textcolor{cyan}{`}\hsspace {\rm{}larger}\\\hstab \textcolor{blue}{{\it{}-- NOTE: this arbitrarily prefers the edits on the left-hand side of the}}\\\hstab \textcolor{blue}{{\it{}-- deletion boundary over the edits on the right-hand side of the deletion}}\\\hstab \textcolor{blue}{{\it{}-- boundary when a chunk boundary happens to fall on a position that}}\\\hstab \textcolor{blue}{{\it{}-- matches the deletion boundary}}\\\\\textcolor{blue}{{\it{}-- input: the locations of chunk boundaries, plus some edits}}\\\textcolor{blue}{{\it{}-- returns:}}\\\textcolor{blue}{{\it{}--   The inner Map Int Int tells, for each index into the edits, whether to split the resulting edit and where.}}\\\textcolor{blue}{{\it{}--   The outer Map tells, for each position, if a chunk boundary ends up landing there, how to split the edits.}}\\\textcolor{blue}{trackEdits}\hsspace \textcolor{red}{::}\hsspace \textcolor{red}{[}{\rm{}Int}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Map}\hsspace {\rm{}Int}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Map}\hsspace {\rm{}Int}\hsspace {\rm{}Int}\textcolor{cyan}{)}\\\textcolor{blue}{trackEdits}\hsspace {\rm{}boundaries}\hsspace \textcolor{red}{=}\hsspace {\rm{}snd}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}foldr}\hsspace {\rm{}trackEdit}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{0}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}fromList}\hsspace \textcolor{cyan}{(}{\rm{}zip}\hsspace {\rm{}boundaries}\hsspace \textcolor{cyan}{(}{\rm{}repeat}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}empty}\textcolor{cyan}{)}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{splitEdits}\hsspace \textcolor{red}{::}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Map}\hsspace {\rm{}Int}\hsspace {\rm{}Int}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Int}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{)}\\\textcolor{blue}{splitEdits}\hsspace {\rm{}m}\hsspace {\rm{}split}\hsspace \textcolor{red}{=}\hsspace {\rm{}snd}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}foldr}\hsspace {\rm{}splitEdit}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}\textcolor{magenta}{0}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}[]}\textcolor{cyan}{,}\hsspace {\rm{}[]}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}splitEdit}\hsspace \textcolor{red}{::}\hsspace {\rm{}Edit}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}Int}\textcolor{cyan}{,}\hsspace {\rm{}Int}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}Int}\textcolor{cyan}{,}\hsspace {\rm{}Int}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}splitEdit}\hsspace {\rm{}e}\textcolor{red}{@}\textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}n}\hsspace {\rm{}n'}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}els}\textcolor{cyan}{,}\hsspace {\rm{}ers}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace {\rm{}n'}\hsspace \textcolor{red}{=}\hsspace {\rm{}splitEdit}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}n'}\hsspace {\rm{}n}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}els}\textcolor{cyan}{,}\hsspace {\rm{}ers}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n'}\hsspace \textcolor{cyan}{\ensuremath{\langle}=}\hsspace {\rm{}split}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{blue}{{\it{}-}}{\rm{}n'}\textcolor{cyan}{+}{\rm{}n}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}e}\textcolor{red}{{\bf{}:}}{\rm{}els}\textcolor{cyan}{,}\hsspace {\rm{}ers}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n}\hsspace \hsspace \textcolor{cyan}{\ensuremath{\rangle}=}\hsspace {\rm{}split}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}els}\textcolor{cyan}{,}\hsspace {\rm{}Delete}\hsspace \textcolor{cyan}{(}{\rm{}n}\textcolor{blue}{{\it{}-}}{\rm{}split}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}n'}\textcolor{blue}{{\it{}-}}{\rm{}split}\textcolor{cyan}{)}\hsspace \textcolor{red}{{\bf{}:}}\hsspace {\rm{}ers}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}otherwise}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}error}\hsspace \textcolor{magenta}{``The impossible happened! A deletion crossed a chunk boundary.''}\\\hstab \hstab \textcolor{blue}{{\it{}--  \ensuremath{|} otherwise   = ((i+1, n), (Delete n split : els, Delete 0 (n'-split) : ers))}}\\\hstab {\rm{}splitEdit}\hsspace {\rm{}e}\textcolor{red}{@}\textcolor{cyan}{(}{\rm{}Insert}\hsspace {\rm{}n}\hsspace {\rm{}s}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}els}\textcolor{cyan}{,}\hsspace {\rm{}ers}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}lookup}\hsspace {\rm{}i}\hsspace {\rm{}m}\hsspace \textcolor{green}{\underline{of}}\\\hstab \hstab {\rm{}Nothing}\\\hstab \hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{\ensuremath{\langle}}\hsspace {\rm{}split}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{cyan}{+}{\rm{}length}\hsspace {\rm{}s}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}e}\textcolor{red}{{\bf{}:}}{\rm{}els}\textcolor{cyan}{,}\hsspace {\rm{}ers}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace {\rm{}split}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}els}\textcolor{cyan}{,}\hsspace {\rm{}Insert}\hsspace \textcolor{cyan}{(}{\rm{}n}\textcolor{blue}{{\it{}-}}{\rm{}split}\textcolor{cyan}{)}\hsspace {\rm{}s}\hsspace \textcolor{red}{{\bf{}:}}\hsspace {\rm{}ers}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}otherwise}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}error}\hsspace \textcolor{magenta}{``The impossible happened! An insertion crossed a chunk boundary without being in the splitting map.''}\\\hstab \hstab {\rm{}Just}\hsspace {\rm{}n'}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}split}\textcolor{cyan}{+}{\rm{}n'}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}consInsert}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{(}{\rm{}take}\hsspace {\rm{}n'}\hsspace {\rm{}s}\textcolor{cyan}{)}\hsspace {\rm{}els}\textcolor{cyan}{,}\hsspace {\rm{}consInsert}\hsspace \textcolor{magenta}{0}\hsspace \textcolor{cyan}{(}{\rm{}drop}\hsspace {\rm{}n'}\hsspace {\rm{}s}\textcolor{cyan}{)}\hsspace {\rm{}ers}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}consInsert}\hsspace {\rm{}n}\hsspace \textcolor{magenta}{``''}\hsspace {\rm{}es}\hsspace \textcolor{red}{=}\hsspace {\rm{}es}\\\hstab {\rm{}consInsert}\hsspace {\rm{}n}\hsspace {\rm{}s}\hsspace \hsspace {\rm{}es}\hsspace \textcolor{red}{=}\hsspace {\rm{}Insert}\hsspace {\rm{}n}\hsspace {\rm{}s}\hsspace \textcolor{red}{{\bf{}:}}\hsspace {\rm{}es}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Asterisk}\hsspace {\rm{}m}\hsspace \textcolor{red}{=}\hsspace {\rm{}Asterisk}\hsspace {\rm{}m}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}StringModule}\hsspace {\rm{}m}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}StringModule}\hsspace \textcolor{cyan}{(}{\rm{}Asterisk}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}M}\hsspace \textcolor{cyan}{(}{\rm{}Asterisk}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ContainerAtom}\hsspace {\rm{}Int}\hsspace \textcolor{cyan}{(}{\rm{}M}\hsspace {\rm{}m}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab {\rm{}valid}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}Asterisk}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{magenta}{``(''}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}valid}\hsspace {\rm{}m}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{magenta}{``)*''}\\\hstab {\rm{}pprint}\hsspace \textcolor{cyan}{(}{\rm{}Asterisk}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}containerToList}\hsspace \textcolor{cyan}{\ensuremath{\rangle}=\ensuremath{\rangle}}\hsspace {\rm{}pprint}\hsspace {\rm{}m}\\\hstab {\rm{}edit}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}Asterisk}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}editList}\hsspace {\rm{}m}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}containerToList}\\\hstab {\rm{}parse}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}Asterisk}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}liftM}\hsspace {\rm{}listToContainer}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}parseList}\hsspace {\rm{}m}\\\\\textcolor{blue}{parseList}\hsspace {\rm{}m}\hsspace \textcolor{red}{=}\hsspace {\rm{}splitList}\hsspace \textcolor{cyan}{(}{\rm{}valid}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{\ensuremath{\rangle}=\ensuremath{\rangle}}\hsspace {\rm{}mapM}\hsspace \textcolor{cyan}{(}{\rm{}parse}\hsspace {\rm{}m}\textcolor{cyan}{)}\\\textcolor{blue}{splitList}\hsspace {\rm{}re}\hsspace \textcolor{magenta}{``''}\hsspace \textcolor{red}{=}\hsspace {\rm{}return}\hsspace {\rm{}[]}\\\textcolor{blue}{splitList}\hsspace {\rm{}re}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{do}}\\\hstab \textcolor{blue}{{\it{}-- pattern match failure means the regex didn't match at the beginning,}}\\\hstab \textcolor{blue}{{\it{}-- and results in a failed parse overall}}\\\hstab \textcolor{cyan}{(}\textcolor{magenta}{``''}\textcolor{cyan}{,}\hsspace {\rm{}sMatch}\textcolor{cyan}{,}\hsspace {\rm{}rest}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}return}\hsspace \textcolor{cyan}{(}{\rm{}s}\hsspace \textcolor{cyan}{=\tilde{ }}\hsspace {\rm{}re}\textcolor{cyan}{)}\\\hstab {\rm{}liftM}\hsspace \textcolor{cyan}{(}{\rm{}sMatch}\textcolor{red}{{\bf{}:}}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}splitList}\hsspace {\rm{}re}\hsspace {\rm{}rest}\textcolor{cyan}{)}\\\\\textcolor{blue}{{\it{}-- Heuristic: if we can track where *all* the old splits went, then go ahead}}\\\textcolor{blue}{{\it{}-- and do that. Nice! Otherwise, use diff to compare the entire old list with}}\\\textcolor{blue}{{\it{}-- the entire new list.}}\\\textcolor{blue}{{\it{}--}}\\\textcolor{blue}{{\it{}-- There's a lot of room for improvement: we could take the regions between}}\\\textcolor{blue}{{\it{}-- successfully tracked splits and the regions with unsuccessfully tracked}}\\\textcolor{blue}{{\it{}-- splits and run the diff only on the unsuccessful regions, for example.}}\\\textcolor{blue}{{\it{}-- Additionally, note that when we are tracking splits, we assume that no}}\\\textcolor{blue}{{\it{}-- splits are inserted or deleted. A more sophisticated heuristic might try to}}\\\textcolor{blue}{{\it{}-- relax this assumption somehow (though the only way I could think of to relax}}\\\textcolor{blue}{{\it{}-- it would result in an exponential-time algorithm).}}\\\\\textcolor{blue}{editList}\hsspace {\rm{}m}\hsspace {\rm{}vs}\hsspace {\rm{}es}\hsspace \textcolor{red}{=}\hsspace {\rm{}fromMaybe}\hsspace {\rm{}diffy}\hsspace {\rm{}exact}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}exact}\hsspace \textcolor{red}{=}\hsspace {\rm{}editListExact}\hsspace {\rm{}m}\hsspace {\rm{}vs}\hsspace {\rm{}oldss}\hsspace {\rm{}newss}\hsspace {\rm{}es}\hsspace \textcolor{magenta}{0}\\\hstab {\rm{}diffy}\hsspace \textcolor{red}{=}\hsspace {\rm{}editListDiff}\hsspace \hsspace {\rm{}m}\hsspace \hsspace \hsspace \hsspace {\rm{}oldss}\hsspace {\rm{}newss}\\\hstab {\rm{}oldss}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}pprint}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace {\rm{}vs}\\\hstab {\rm{}newss}\hsspace \textcolor{red}{=}\hsspace {\rm{}fromJust}\hsspace \textcolor{cyan}{(}{\rm{}splitList}\hsspace \textcolor{cyan}{(}{\rm{}valid}\hsspace {\rm{}m}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{=\ensuremath{\langle}\ensuremath{\langle}}\hsspace {\rm{}apply}\hsspace {\rm{}es}\hsspace \textcolor{cyan}{(}{\rm{}concat}\hsspace {\rm{}oldss}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{::}\hsspace \textcolor{red}{[}{\rm{}String}\textcolor{red}{]}\\\\\textcolor{blue}{editListExact}\hsspace {\rm{}m}\hsspace \textcolor{cyan}{(}{\rm{}v}\textcolor{red}{{\bf{}:}}{\rm{}vs}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}olds}\textcolor{red}{{\bf{}:}}{\rm{}oldss}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}news}\textcolor{red}{{\bf{}:}}{\rm{}newss}\textcolor{cyan}{)}\hsspace {\rm{}es}\hsspace {\rm{}i}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}splitMap}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}Nothing}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Nothing}\\\hstab {\rm{}Just}\hsspace {\rm{}ms}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}liftM}\hsspace \textcolor{cyan}{(}{\rm{}modifyHere}\textcolor{cyan}{++}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}editListExact}\hsspace {\rm{}m}\hsspace {\rm{}vs}\hsspace {\rm{}oldss}\hsspace {\rm{}newss}\hsspace {\rm{}erest}\hsspace \textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{where}}\\\hstab {\rm{}oldSplit}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}length}\hsspace {\rm{}olds}\\\hstab {\rm{}newSplit}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}length}\hsspace {\rm{}news}\\\hstab {\rm{}easySplits}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}trackEdits}\hsspace \textcolor{red}{[}{\rm{}oldSplit}\textcolor{red}{]}\hsspace {\rm{}es}\\\hstab {\rm{}splitMap}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}lookup}\hsspace {\rm{}newSplit}\hsspace {\rm{}easySplits}\\\hstab \textcolor{blue}{{\it{}-- this is dangerous, only use the variables it binds when splitMap is definitely a Just!}}\\\hstab \textcolor{cyan}{(}{\rm{}e}\textcolor{cyan}{,}\hsspace {\rm{}erest}\textcolor{cyan}{)}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}splitEdits}\hsspace \textcolor{cyan}{(}{\rm{}fromJust}\hsspace {\rm{}splitMap}\textcolor{cyan}{)}\hsspace {\rm{}oldSplit}\hsspace {\rm{}es}\\\hstab {\rm{}modifyHere}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}C}\textcolor{cyan}{.}{\rm{}Modify}\hsspace {\rm{}i}\hsspace \textcolor{cyan}{(}{\rm{}edit}\hsspace {\rm{}m}\hsspace {\rm{}v}\hsspace {\rm{}e}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}not}\hsspace \textcolor{cyan}{(}{\rm{}null}\hsspace {\rm{}e}\textcolor{cyan}{)}\textcolor{red}{]}\\\textcolor{blue}{editListExact}\hsspace {\rm{}m}\hsspace {\rm{}[]}\hsspace {\rm{}[]}\hsspace {\rm{}[]}\hsspace {\rm{}[]}\hsspace {\rm{}i}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace {\rm{}[]}\\\textcolor{blue}{editListExact}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{green}{\underline{\_}}\hsspace \hsspace \textcolor{green}{\underline{\_}}\hsspace \hsspace \textcolor{green}{\underline{\_}}\hsspace \hsspace \textcolor{green}{\underline{\_}}\hsspace \hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}Nothing}\\\\\textcolor{blue}{editListDiff}\hsspace {\rm{}m}\hsspace {\rm{}oldss}\hsspace {\rm{}newss}\hsspace \textcolor{red}{=}\hsspace {\rm{}result}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}diff}\hsspace \textcolor{red}{=}\hsspace {\rm{}getDiff}\hsspace {\rm{}oldss}\hsspace {\rm{}newss}\\\hstab {\rm{}tags}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace {\rm{}fst}\hsspace {\rm{}diff}\\\hstab {\rm{}count}\hsspace {\rm{}place}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}length}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}filter}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{==}{\rm{}place}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{\$}\hsspace {\rm{}tags}\\\hstab \textcolor{cyan}{(}{\rm{}countS}\textcolor{cyan}{,}\hsspace {\rm{}countF}\textcolor{cyan}{)}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}count}\hsspace {\rm{}S}\textcolor{cyan}{,}\hsspace {\rm{}count}\hsspace {\rm{}F}\textcolor{cyan}{)}\\\hstab {\rm{}match}\hsspace {\rm{}place}\hsspace {\rm{}B}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}True}\textcolor{red}{]}\\\hstab {\rm{}match}\hsspace {\rm{}place}\hsspace {\rm{}place'}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}False}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}place}\hsspace \textcolor{cyan}{==}\hsspace {\rm{}place'}\textcolor{red}{]}\\\hstab {\rm{}reordered}\hsspace {\rm{}place}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace {\rm{}fst}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}uncurry}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{++}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}partition}\hsspace {\rm{}snd}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}zip}\hsspace \textcolor{red}{[}\textcolor{magenta}{0}\textcolor{red}{..}\textcolor{red}{]}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{cyan}{(}{\rm{}tags}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}match}\hsspace {\rm{}place}\textcolor{cyan}{)}\\\hstab {\rm{}needsReorder}\hsspace {\rm{}place}\hsspace \textcolor{red}{=}\hsspace {\rm{}any}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{==}{\rm{}B}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}dropWhile}\hsspace \textcolor{cyan}{(}{\rm{}place}\hsspace \textcolor{cyan}{/=}\textcolor{cyan}{)}\hsspace {\rm{}tags}\textcolor{cyan}{)}\\\hstab {\rm{}create}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace {\rm{}edit}\hsspace {\rm{}m}\hsspace {\rm{}def}\hsspace \textcolor{red}{[}{\rm{}Insert}\hsspace \textcolor{magenta}{0}\hsspace {\rm{}s}\textcolor{cyan}{,}\hsspace {\rm{}Delete}\hsspace \textcolor{magenta}{0}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}length}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}pprint}\hsspace {\rm{}m}\hsspace \textcolor{cyan}{\$}\hsspace {\rm{}def}\textcolor{red}{]}\\\hstab {\rm{}result}\\\hstab \hstab \textcolor{red}{=}\hsspace \hsspace \textcolor{red}{[}{\rm{}C}\textcolor{cyan}{.}{\rm{}Rearrange}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace \textcolor{magenta}{0}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}\textcolor{red}{$\backslash$}\textcolor{green}{\underline{\_}}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}fromJust}\hsspace \textcolor{cyan}{(}{\rm{}findIndex}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{==}{\rm{}i}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}reordered}\hsspace {\rm{}S}\textcolor{cyan}{)}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}needsReorder}\hsspace {\rm{}S}\textcolor{red}{]}\\\hstab \hstab \textcolor{cyan}{++}\hsspace {\rm{}zipWith}\hsspace {\rm{}C}\textcolor{cyan}{.}{\rm{}Modify}\hsspace \textcolor{red}{[}{\rm{}count}\hsspace {\rm{}B}\hsspace \textcolor{red}{..}\hsspace {\rm{}count}\hsspace {\rm{}B}\hsspace \textcolor{cyan}{+}\hsspace {\rm{}count}\hsspace {\rm{}S}\hsspace \textcolor{blue}{{\it{}-}}\hsspace \textcolor{magenta}{1}\textcolor{red}{]}\hsspace \textcolor{red}{[}{\rm{}create}\hsspace {\rm{}news}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace \textcolor{cyan}{(}{\rm{}S}\textcolor{cyan}{,}\hsspace {\rm{}news}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}diff}\textcolor{red}{]}\\\hstab \hstab \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}C}\textcolor{cyan}{.}{\rm{}Insert}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}Sum}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{\$}\hsspace {\rm{}countS}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}countS}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace \textcolor{magenta}{0}\textcolor{red}{]}\\\hstab \hstab \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}C}\textcolor{cyan}{.}{\rm{}Delete}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}Sum}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}negate}\hsspace \textcolor{cyan}{\$}\hsspace {\rm{}countF}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}countF}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace \textcolor{magenta}{0}\textcolor{red}{]}\\\hstab \hstab \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}C}\textcolor{cyan}{.}{\rm{}Rearrange}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace \textcolor{magenta}{0}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}\textcolor{red}{$\backslash$}\textcolor{green}{\underline{\_}}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}reordered}\hsspace {\rm{}F}\hsspace \textcolor{cyan}{!!}\hsspace {\rm{}i}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}needsReorder}\hsspace {\rm{}F}\textcolor{red}{]}\\\\\textcolor{blue}{{\it{}-- a few utilities for defining string modules whose default value is not ""}}\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}NewDefault}\hsspace {\rm{}v}\hsspace \textcolor{red}{=}\hsspace {\rm{}NewDefault}\hsspace {\rm{}String}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Show}\hsspace \textcolor{cyan}{(}{\rm{}NewDefault}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}show}\hsspace \textcolor{cyan}{(}{\rm{}NewDefault}\hsspace {\rm{}s}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}show}\hsspace {\rm{}s}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Read}\hsspace \textcolor{cyan}{(}{\rm{}NewDefault}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}readsPrec}\hsspace {\rm{}n}\hsspace {\rm{}s}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}first}\hsspace {\rm{}NewDefault}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}readsPrec}\hsspace {\rm{}n}\hsspace {\rm{}s}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Default}\hsspace {\rm{}v}\textcolor{cyan}{,}\hsspace {\rm{}Show}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Default}\hsspace \textcolor{cyan}{(}{\rm{}NewDefault}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}def}\hsspace \textcolor{red}{=}\hsspace {\rm{}NewDefault}\hsspace \textcolor{cyan}{(}{\rm{}show}\hsspace \textcolor{cyan}{(}{\rm{}def}\hsspace \textcolor{red}{::}\hsspace {\rm{}v}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}NewDefaultModule}\hsspace {\rm{}v}\hsspace \textcolor{red}{=}\hsspace {\rm{}NewDefaultModule}\hsspace \textcolor{red}{[}{\rm{}Edit}\textcolor{red}{]}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{,}\hsspace {\rm{}Monoid}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Default}\hsspace {\rm{}v}\textcolor{cyan}{,}\hsspace {\rm{}Show}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultModule}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultModule}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}NewDefault}\hsspace {\rm{}v}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultModule}\hsspace {\rm{}es}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}NewDefault}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}liftM}\hsspace {\rm{}NewDefault}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}es}\hsspace {\rm{}v}\textcolor{cyan}{)}\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}NewDefaultMatch}\hsspace {\rm{}v}\hsspace \textcolor{red}{=}\hsspace {\rm{}NewDefaultMatch}\hsspace {\rm{}String}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Default}\hsspace {\rm{}v}\textcolor{cyan}{,}\hsspace {\rm{}Show}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}StringModule}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultMatch}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}M}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultMatch}\hsspace {\rm{}v}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}NewDefaultModule}\hsspace {\rm{}v}\\\hstab {\rm{}valid}\hsspace \textcolor{cyan}{(}{\rm{}NewDefaultMatch}\hsspace {\rm{}re}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}re}\\\hstab {\rm{}parse}\hsspace \hsspace {\rm{}m}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}liftM}\hsspace {\rm{}NewDefault}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}maybeMatch}\hsspace \textcolor{cyan}{(}{\rm{}valid}\hsspace {\rm{}m}\textcolor{cyan}{)}\\\hstab {\rm{}pprint}\hsspace {\rm{}m}\hsspace \textcolor{cyan}{(}{\rm{}NewDefault}\hsspace {\rm{}s}\textcolor{cyan}{)}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}s}\\\hstab {\rm{}edit}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace \textcolor{cyan}{(}{\rm{}const}\hsspace {\rm{}NewDefaultModule}\textcolor{cyan}{)}\\
\section{\texttt{lib/edit-lenses.cabal}}
\begin{verbatim}
name:                edit-lenses
version:             0.2
synopsis:            Symmetric, stateful edit lenses
Description:         An implementation of the ideas of the paper /Edit Lenses/,
                     available at <http://dmwit.com/papers/201107EL.pdf>.
-- Homepage:            http://dmwit.com/edit-lenses
license:             BSD3
license-file:        LICENSE
author:              Daniel Wagner
maintainer:          daniel@wagner-home.com
category:            Data
build-type:          Simple
cabal-version:       >=1.8

library
  exposed-modules:
    Data.Container,
    Data.Iso,
    Data.Module,
    Data.Module.Class,
    Data.Module.List,
    Data.Module.Primitive,
    Data.Module.Sum,
    Data.Module.Product,
    Data.Module.Container,
    Data.Module.Shape,
    Data.Lens.Bidirectional,
    Data.Lens.Edit,
    Data.Lens.Edit.Container,
    Data.Lens.Edit.List,
    Data.Lens.Edit.Stateless,
    Data.Lens.Edit.Stateful,
    Data.Lens.Edit.Sum,
    Data.Lens.Edit.Primitive,
    Data.Lens.Edit.Product
  build-depends:
    base >= 3.0 && < 5,
    containers >= 0.3,
    data-default >= 0.3,
    lattices >= 1.2,
    mtl >= 2.0
  extensions:
    FlexibleContexts,
    FlexibleInstances,
    GeneralizedNewtypeDeriving,
    ScopedTypeVariables,
    TypeFamilies,
    TypeOperators
  if impl(ghc)
    -- The meaning of the TypeFamilies extension changed between GHC 7.0 and
    -- GHC 7.2: superclass equality constraints were not possible prior to 7.2.
    -- Since there's no way to depend on a version of GHC, this is the next
    -- best thing: depend on a version of base that's quite new.
    base >= 4.4

\end{verbatim}

\section{\texttt{lib/Data/Container.hs}}
\label{mod:Data.Container}
\textcolor{blue}{{\it{}\{-\# LANGUAGE FlexibleContexts, TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Container}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Algebra}\textcolor{cyan}{.}{\rm{}PartialOrd}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Set}\\\\\textcolor{green}{\underline{type}}\hsspace {\rm{}family}\hsspace {\rm{}ShapeModule}\hsspace {\rm{}shape}\\\\\textcolor{green}{\underline{class}}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}ShapeModule}\hsspace {\rm{}shape}\textcolor{cyan}{)}\hsspace \textcolor{red}{\tilde{ }}\hsspace {\rm{}shape}\textcolor{cyan}{,}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}ShapeModule}\hsspace {\rm{}shape}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}PartialOrd}\hsspace {\rm{}shape}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\hsspace \textcolor{cyan}{(}{\rm{}P}\hsspace {\rm{}shape}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}ContainerType}\hsspace {\rm{}shape}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}P}\hsspace {\rm{}shape}\hsspace \textcolor{blue}{{\it{}-- \_p\_ositions}}\\\hstab {\rm{}live}\hsspace \textcolor{red}{::}\hsspace {\rm{}shape}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Set}\hsspace \textcolor{cyan}{(}{\rm{}P}\hsspace {\rm{}shape}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- monotone}}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Container}\hsspace {\rm{}shape}\hsspace {\rm{}element}\hsspace \textcolor{red}{=}\hsspace {\rm{}Container}\\\hstab \textcolor{cyan}{\{}\hsspace {\rm{}currentShape}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{::}\hsspace {\rm{}shape}\\\hstab \textcolor{cyan}{,}\hsspace {\rm{}containedValues}\hsspace \textcolor{red}{::}\hsspace {\rm{}P}\hsspace {\rm{}shape}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}element}\hsspace \textcolor{blue}{{\it{}-- only need be defined for "live" shapes}}\\\hstab \textcolor{cyan}{\}}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Default}\hsspace {\rm{}shape}\textcolor{cyan}{,}\hsspace {\rm{}Default}\hsspace {\rm{}element}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Default}\hsspace \textcolor{cyan}{(}{\rm{}Container}\hsspace {\rm{}shape}\hsspace {\rm{}element}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}def}\hsspace \textcolor{red}{=}\hsspace {\rm{}Container}\hsspace {\rm{}def}\hsspace \textcolor{cyan}{(}{\rm{}const}\hsspace {\rm{}def}\textcolor{cyan}{)}\\\\\textcolor{blue}{replace}\hsspace {\rm{}p}\hsspace {\rm{}e}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{\{}\hsspace {\rm{}containedValues}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{$\backslash$}{\rm{}p'}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{if}}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{==}\hsspace {\rm{}p'}\hsspace \textcolor{green}{\underline{then}}\hsspace {\rm{}e}\hsspace \textcolor{green}{\underline{else}}\hsspace {\rm{}containedValues}\hsspace {\rm{}c}\hsspace {\rm{}p'}\hsspace \textcolor{cyan}{\}}\\
\section{\texttt{lib/Data/Iso.hs}}
\label{mod:Data.Iso}
\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Iso}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Iso}\hsspace {\rm{}a}\hsspace {\rm{}b}\hsspace \textcolor{red}{=}\hsspace {\rm{}Iso}\hsspace \textcolor{cyan}{(}{\rm{}a}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}b}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}b}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}a}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Show}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}a}\hsspace {\rm{}b}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}show}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}f}\hsspace {\rm{}g}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{magenta}{``Iso \ensuremath{\langle}fn\ensuremath{\rangle} \ensuremath{\langle}fn\ensuremath{\rangle}''}\\
\section{\texttt{lib/Data/Module.hs}}
\label{mod:Data.Module}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies, GeneralizedNewtypeDeriving, FlexibleContexts \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\\\hstab \textcolor{cyan}{(}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}List}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Primitive}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Product}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Shape}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Sum}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\\\hstab \textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}List}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Primitive}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Product}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Shape}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Sum}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\hsspace {\rm{}hiding}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\textcolor{cyan}{(}\textcolor{red}{..}\textcolor{cyan}{)}\textcolor{cyan}{)}\\
\section{\texttt{lib/Data/Lens/Bidirectional.hs}}
\label{mod:Data.Lens.Bidirectional}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies \#-\}}}\\\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{class}}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace {\rm{}l}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace {\rm{}l}\\
\section{\texttt{lib/Data/Lens/Edit.hs}}
\label{mod:Data.Lens.Edit}
\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\\\hstab \textcolor{cyan}{(}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Container}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Primitive}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Product}\\\hstab \textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Sum}\\\hstab \textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Container}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Primitive}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Product}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Sum}\\
\section{\texttt{lib/Data/Lens/Edit/Container.hs}}
\label{mod:Data.Lens.Edit.Container}
\textcolor{blue}{{\it{}\{-\# LANGUAGE FlexibleContexts, TypeFamilies, TypeOperators \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Container}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Container}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Iso}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \textcolor{cyan}{(}{\rm{}C}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- needed for GHC 7.2}}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Container}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}F}\hsspace \textcolor{blue}{{\it{}-- state\_f\_ul}}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateless}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}L}\hsspace \textcolor{blue}{{\it{}-- state\_l\_ess}}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Set}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}S}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Map}\hsspace {\rm{}shape}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}Map}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}shape}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}shape}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ContainerAtom}\hsspace {\rm{}shape}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}shape}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ContainerAtom}\hsspace {\rm{}shape}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}ContainerType}\hsspace {\rm{}shape}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}shape}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}shape}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Container}\hsspace {\rm{}shape}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Container}\hsspace {\rm{}def}\hsspace \textcolor{cyan}{(}{\rm{}const}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputMapF}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputMapF}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}ContainerType}\hsspace {\rm{}shape}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}shape}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}dputMapL}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}dputMapL}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputMapF}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace {\rm{}FailContainer}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailContainer}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\textcolor{blue}{dputMapF}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}Modify}\hsspace {\rm{}p}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace {\rm{}c}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}S}\textcolor{cyan}{.}{\rm{}member}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{(}{\rm{}live}\hsspace \textcolor{cyan}{(}{\rm{}currentShape}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}p}\hsspace {\rm{}dy}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}replace}\hsspace {\rm{}p}\hsspace {\rm{}c'}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}otherwise}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailContainer}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{where}}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}containedValues}\hsspace {\rm{}c}\hsspace {\rm{}p}\textcolor{cyan}{)}\\\textcolor{blue}{dputMapF}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace {\rm{}ds}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}apply}\hsspace {\rm{}ds}\hsspace \textcolor{cyan}{(}{\rm{}currentShape}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}Nothing}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailContainer}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}Just}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Insert}\hsspace {\rm{}ds}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}expand}\hsspace {\rm{}s}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\textcolor{blue}{dputMapF}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}ds}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}apply}\hsspace {\rm{}ds}\hsspace \textcolor{cyan}{(}{\rm{}currentShape}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}Nothing}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailContainer}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}Just}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Delete}\hsspace {\rm{}ds}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}setShape}\hsspace {\rm{}s}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\textcolor{blue}{dputMapF}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}Rearrange}\hsspace {\rm{}ds}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}apply}\hsspace {\rm{}ds}\hsspace \textcolor{cyan}{(}{\rm{}currentShape}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}Nothing}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailContainer}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}Just}\hsspace {\rm{}s}\hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Rearrange}\hsspace {\rm{}ds}\hsspace {\rm{}f}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}reorder}\hsspace {\rm{}f}\hsspace {\rm{}s}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputMapL}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}FailContainer}\hsspace \textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}FailContainer}\\\textcolor{blue}{dputMapL}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}Modify}\hsspace \hsspace \hsspace \hsspace {\rm{}p}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Modify}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{(}{\rm{}dput}\hsspace {\rm{}l}\hsspace {\rm{}dx}\textcolor{cyan}{)}\\\textcolor{blue}{dputMapL}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace \hsspace \hsspace \hsspace {\rm{}ds}\hsspace \hsspace \textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Insert}\hsspace {\rm{}ds}\\\textcolor{blue}{dputMapL}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace \hsspace \hsspace \hsspace {\rm{}ds}\hsspace \hsspace \textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Delete}\hsspace {\rm{}ds}\\\textcolor{blue}{dputMapL}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}Rearrange}\hsspace {\rm{}ds}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Rearrange}\hsspace {\rm{}ds}\hsspace {\rm{}f}\\
\section{\texttt{lib/Data/Lens/Edit/List.hs}}
\label{mod:Data.Lens.Edit.List}
\textcolor{blue}{{\it{}\{-\# LANGUAGE NoMonomorphismRestriction, TypeFamilies \#-\}}}\\\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}List}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \textcolor{cyan}{(}{\rm{}C}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- needed for GHC 7.2}}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}List}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}List}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Product}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Sum}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}F}\hsspace \textcolor{blue}{{\it{}-- state\_f\_ul}}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateless}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}L}\hsspace \textcolor{blue}{{\it{}-- state\_l\_ess}}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Map}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}Map}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ListAtom}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ListAtom}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}C}\hsspace {\rm{}l}\textcolor{red}{]}\\\hstab {\rm{}missing}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}[]}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputMapF}\hsspace {\rm{}l}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputMapF}\hsspace {\rm{}l}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputMapF}\hsspace {\rm{}l}\hsspace {\rm{}dput}\hsspace {\rm{}e}\hsspace {\rm{}cs}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}e}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}FailList}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailList}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}cs}\textcolor{cyan}{)}\\\hstab {\rm{}Modify}\hsspace {\rm{}p}\hsspace {\rm{}dx}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}split3}\hsspace {\rm{}p}\hsspace {\rm{}cs}\hsspace \textcolor{green}{\underline{of}}\\\hstab \hstab {\rm{}Just}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{,}\hsspace {\rm{}e}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dput}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}p}\hsspace {\rm{}dy}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}b}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}c'}\textcolor{red}{]}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}e}\textcolor{cyan}{)}\\\hstab \hstab {\rm{}Nothing}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailList}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}cs}\textcolor{cyan}{)}\\\hstab {\rm{}Insert}\hsspace {\rm{}i}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Insert}\hsspace {\rm{}i}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}cs}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}genericReplicate}\hsspace {\rm{}i}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}Delete}\hsspace {\rm{}i}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Delete}\hsspace {\rm{}i}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}zipWith}\hsspace {\rm{}const}\hsspace {\rm{}cs}\hsspace \textcolor{cyan}{(}{\rm{}genericDrop}\hsspace {\rm{}i}\hsspace {\rm{}cs}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}Rearrange}\hsspace {\rm{}p}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Rearrange}\hsspace {\rm{}p}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}applyPermutation}\hsspace {\rm{}p}\hsspace {\rm{}cs}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}dputMapL}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Map}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}dputMapL}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputMapL}\hsspace {\rm{}dput}\hsspace {\rm{}e}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}e}\hsspace \textcolor{green}{\underline{of}}\\\hstab \textcolor{blue}{{\it{}\{-
	Modify p dx \ensuremath{\rightarrow} Modify p (dput dx)
	\_ \ensuremath{\rightarrow} unsafeCoerce e
	-\}}}\\\hstab {\rm{}FailList}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}FailList}\\\hstab {\rm{}Modify}\hsspace {\rm{}p}\hsspace {\rm{}dx}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Modify}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{(}{\rm{}dput}\hsspace {\rm{}dx}\textcolor{cyan}{)}\\\hstab {\rm{}Insert}\hsspace {\rm{}i}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Insert}\hsspace {\rm{}i}\\\hstab {\rm{}Delete}\hsspace {\rm{}i}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Delete}\hsspace {\rm{}i}\\\hstab {\rm{}Rearrange}\hsspace {\rm{}p}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Rearrange}\hsspace {\rm{}p}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Partition}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\hsspace \textcolor{red}{=}\hsspace {\rm{}Partition}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Partition}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Partition}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ListAtom}\hsspace \textcolor{red}{[}{\rm{}SumAtom}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{red}{]}\textcolor{red}{]}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Partition}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ProductAtom}\hsspace \textcolor{red}{[}{\rm{}ListAtom}\hsspace {\rm{}dX}\textcolor{red}{]}\hsspace \textcolor{red}{[}{\rm{}ListAtom}\hsspace {\rm{}dY}\textcolor{red}{]}\textcolor{red}{]}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Monoid}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}Monoid}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Partition}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}Partition}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}Tag}\textcolor{red}{]}\\\hstab {\rm{}missing}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}[]}\\\hstab {\rm{}dputr}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace {\rm{}dputrPartition}\\\hstab {\rm{}dputl}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace {\rm{}dputlPartition}\\\\\textcolor{blue}{dputrPartition}\hsspace \textcolor{cyan}{(}{\rm{}Modify}\hsspace {\rm{}p}\hsspace {\rm{}dvs}\textcolor{cyan}{)}\hsspace {\rm{}c}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace \textcolor{magenta}{1}\hsspace \textcolor{cyan}{\ensuremath{\langle}=}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{\&\&}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{\ensuremath{\langle}=}\hsspace {\rm{}n}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputrPartitionMod}\hsspace {\rm{}p}\hsspace {\rm{}n}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}dvs}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}otherwise}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}failPartition}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{where}}\hsspace {\rm{}n}\hsspace \textcolor{red}{=}\hsspace {\rm{}genericLength}\hsspace {\rm{}c}\\\textcolor{blue}{dputrPartition}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace {\rm{}i}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Left}\hsspace \textcolor{red}{[}{\rm{}Insert}\hsspace {\rm{}i}\textcolor{red}{]}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}genericReplicate}\hsspace {\rm{}i}\hsspace {\rm{}L}\textcolor{cyan}{)}\\\textcolor{blue}{dputrPartition}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}i}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}d1}\textcolor{cyan}{,}\hsspace {\rm{}d0}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}del}\hsspace {\rm{}i}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}del}\hsspace {\rm{}i}\hsspace {\rm{}c}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}zipWith}\hsspace {\rm{}const}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{(}{\rm{}genericDrop}\hsspace {\rm{}i}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}{\rm{}nL}\textcolor{cyan}{,}\hsspace {\rm{}nR}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}count}\hsspace \textcolor{cyan}{(}{\rm{}i}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}reverse}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}d0}\hsspace \textcolor{red}{=}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{red}{[}{\rm{}Delete}\hsspace \textcolor{cyan}{(}{\rm{}nL}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab {\rm{}d1}\hsspace \textcolor{red}{=}\hsspace {\rm{}Right}\hsspace \textcolor{red}{[}{\rm{}Delete}\hsspace \textcolor{cyan}{(}{\rm{}nR}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{cyan}{)}\textcolor{red}{]}\\\textcolor{blue}{dputrPartition}\hsspace \textcolor{cyan}{(}{\rm{}Rearrange}\hsspace {\rm{}p}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}dL}\textcolor{cyan}{,}\hsspace {\rm{}dR}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}n}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}genericLength}\hsspace {\rm{}c}\\\hstab \textcolor{cyan}{(}{\rm{}nL}\textcolor{cyan}{,}\hsspace {\rm{}nR}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}count}\hsspace \textcolor{cyan}{(}{\rm{}n}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace {\rm{}c}\\\hstab {\rm{}c'}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}applyPermutation}\hsspace {\rm{}p}\hsspace {\rm{}c}\\\hstab {\rm{}dL}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{red}{[}{\rm{}Rearrange}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace {\rm{}iL}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab {\rm{}dR}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}Right}\hsspace \textcolor{red}{[}{\rm{}Rearrange}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace {\rm{}iR}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab {\rm{}iL}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}out}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}h}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}Left}\hsspace \textcolor{cyan}{)}\hsspace \textcolor{red}{[}\textcolor{magenta}{1}\textcolor{red}{..}{\rm{}nL}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{red}{]}\\\hstab {\rm{}iR}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}out}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}h}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}Right}\textcolor{cyan}{)}\hsspace \textcolor{red}{[}\textcolor{magenta}{1}\textcolor{red}{..}{\rm{}nR}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{red}{]}\\\hstab {\rm{}out}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}either}\hsspace {\rm{}id}\hsspace {\rm{}id}\\\hstab {\rm{}h}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}iso}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}complexPermutation}\hsspace {\rm{}p}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}isoInv}\hsspace {\rm{}c'}\\\textcolor{blue}{dputrPartition}\hsspace {\rm{}FailList}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}failPartition}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputrPartitionMod}\hsspace {\rm{}p}\hsspace {\rm{}n}\hsspace {\rm{}e}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}e}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}FailSum}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}failPartition}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}StayL}\hsspace {\rm{}dv}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Left}\hsspace \hsspace \textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}pL}\hsspace {\rm{}dv}\textcolor{red}{]}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}StayR}\hsspace {\rm{}dv}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Right}\hsspace \textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}pR}\hsspace {\rm{}dv}\textcolor{red}{]}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}SwitchLL}\hsspace {\rm{}dv}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Left}\hsspace \hsspace \textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}pL}\hsspace {\rm{}dv}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}ins}\hsspace {\rm{}pL}\hsspace {\rm{}n}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}del}\hsspace {\rm{}pL}\hsspace {\rm{}n}\textcolor{cyan}{)}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}set}\hsspace {\rm{}L}\textcolor{cyan}{)}\\\hstab {\rm{}SwitchLR}\hsspace {\rm{}dv}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Right}\hsspace \textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}pR}\hsspace {\rm{}dv}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}ins}\hsspace {\rm{}pR}\hsspace {\rm{}n}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}del}\hsspace {\rm{}pL}\hsspace {\rm{}n}\textcolor{cyan}{)}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}set}\hsspace {\rm{}R}\textcolor{cyan}{)}\\\hstab {\rm{}SwitchRL}\hsspace {\rm{}dv}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Left}\hsspace \hsspace \textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}pL}\hsspace {\rm{}dv}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}ins}\hsspace {\rm{}pL}\hsspace {\rm{}n}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}del}\hsspace {\rm{}pR}\hsspace {\rm{}n}\textcolor{cyan}{)}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}set}\hsspace {\rm{}L}\textcolor{cyan}{)}\\\hstab {\rm{}SwitchRR}\hsspace {\rm{}dv}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Right}\hsspace \textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}pR}\hsspace {\rm{}dv}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}ins}\hsspace {\rm{}pR}\hsspace {\rm{}n}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}del}\hsspace {\rm{}pR}\hsspace {\rm{}n}\textcolor{cyan}{)}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}set}\hsspace {\rm{}R}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{where}}\\\hstab \textcolor{cyan}{(}{\rm{}pL}\textcolor{cyan}{,}\hsspace {\rm{}pR}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}count}\hsspace {\rm{}p}\hsspace {\rm{}c}\\\hstab {\rm{}set}\hsspace {\rm{}v}\hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}split3}\hsspace {\rm{}p}\hsspace {\rm{}c}\hsspace \textcolor{green}{\underline{of}}\\\hstab \hstab {\rm{}Just}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}e}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}b}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}v}\textcolor{red}{]}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}e}\\\hstab \hstab {\rm{}Nothing}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}c}\\\\\textcolor{blue}{dputlPartition}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \hsspace {\rm{}dvs}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputlPartition'}\hsspace {\rm{}L}\hsspace {\rm{}StayL}\hsspace {\rm{}SwitchLL}\hsspace {\rm{}onL}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}dvs}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\textcolor{blue}{dputlPartition}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace {\rm{}dvs}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputlPartition'}\hsspace {\rm{}R}\hsspace {\rm{}StayR}\hsspace {\rm{}SwitchLR}\hsspace {\rm{}onR}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}dvs}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputlPartition'}\hsspace {\rm{}j}\hsspace {\rm{}stayj}\hsspace {\rm{}switchLj}\hsspace {\rm{}onj}\hsspace {\rm{}e}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}e}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}Modify}\hsspace {\rm{}p}\hsspace {\rm{}dx}\\\hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace \textcolor{magenta}{1}\hsspace \textcolor{cyan}{\ensuremath{\langle}=}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{\&\&}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{\ensuremath{\langle}=}\hsspace {\rm{}n}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}p'}\hsspace \textcolor{red}{[}{\rm{}stayj}\hsspace {\rm{}dx}\textcolor{red}{]}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}otherwise}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailList}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{green}{\underline{where}}\\\hstab \hstab {\rm{}n}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}genericLength}\hsspace {\rm{}c}\\\hstab \hstab {\rm{}p'}\hsspace \textcolor{red}{=}\hsspace {\rm{}isoInv}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{(}{\rm{}tag}\hsspace {\rm{}j}\hsspace {\rm{}p}\textcolor{cyan}{)}\\\hstab {\rm{}Insert}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}switches}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}insert}\textcolor{cyan}{,}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}genericReplicate}\hsspace {\rm{}i}\hsspace {\rm{}j}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \hstab {\rm{}n}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}genericLength}\hsspace {\rm{}c}\\\hstab \hstab {\rm{}switches}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}Modify}\hsspace {\rm{}p}\hsspace \textcolor{red}{[}{\rm{}switchLj}\hsspace {\rm{}mempty}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}p}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace \textcolor{red}{[}{\rm{}n}\textcolor{cyan}{+}\textcolor{magenta}{1}\hsspace \textcolor{red}{..}\hsspace {\rm{}n}\textcolor{cyan}{+}{\rm{}i}\textcolor{red}{]}\textcolor{red}{]}\\\hstab \hstab {\rm{}insert}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}Insert}\hsspace {\rm{}i}\textcolor{red}{]}\\\hstab {\rm{}Delete}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace {\rm{}dputlPartitionDelete}\hsspace \textcolor{cyan}{(}{\rm{}genericReplicate}\hsspace {\rm{}i}\hsspace {\rm{}j}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}Rearrange}\hsspace {\rm{}p}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Rearrange}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace {\rm{}is}\textcolor{cyan}{)}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \hstab {\rm{}nj}\hsspace \textcolor{red}{=}\hsspace {\rm{}sum}\hsspace \textcolor{red}{[}\textcolor{magenta}{1}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}k}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}c}\textcolor{cyan}{,}\hsspace {\rm{}j}\hsspace \textcolor{cyan}{==}\hsspace {\rm{}k}\textcolor{red}{]}\\\hstab \hstab {\rm{}g}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}onj}\hsspace \textcolor{cyan}{(}{\rm{}complexPermutation}\hsspace {\rm{}p}\hsspace {\rm{}nj}\textcolor{cyan}{)}\\\hstab \hstab {\rm{}f}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}isoInv}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}g}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}iso}\hsspace {\rm{}c}\\\hstab \hstab {\rm{}is}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace {\rm{}f}\hsspace \textcolor{red}{[}\textcolor{magenta}{1}\textcolor{red}{..}{\rm{}length}\hsspace {\rm{}c}\textcolor{red}{]}\\\hstab {\rm{}FailList}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}FailList}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputlPartitionDelete}\hsspace {\rm{}j}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}del}\hsspace {\rm{}p}\hsspace {\rm{}n}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}n}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}genericLength}\hsspace {\rm{}c}\\\hstab {\rm{}nj}\hsspace \textcolor{red}{=}\hsspace {\rm{}sum}\hsspace \textcolor{red}{[}\textcolor{magenta}{1}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}k}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}c}\textcolor{cyan}{,}\hsspace {\rm{}j}\hsspace \textcolor{cyan}{==}\hsspace {\rm{}k}\textcolor{red}{]}\\\hstab {\rm{}p}\hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}isoInv}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{(}{\rm{}tag}\hsspace {\rm{}j}\hsspace {\rm{}nj}\textcolor{cyan}{)}\\\hstab {\rm{}c'}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}split3}\hsspace {\rm{}p}\hsspace {\rm{}c}\hsspace \textcolor{green}{\underline{of}}\\\hstab \hstab {\rm{}Just}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace \textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}e}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}b}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}e}\\\\\textcolor{blue}{failPartition}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}Left}\hsspace \textcolor{red}{[}{\rm{}FailList}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace \textcolor{red}{[}{\rm{}FailList}\textcolor{red}{]}\textcolor{red}{]}\\\\\textcolor{blue}{{\it{}-- TODO: implement in terms of functions like length/filter}}\\\textcolor{blue}{count}\hsspace {\rm{}p}\hsspace {\rm{}[]}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{1}\textcolor{cyan}{,}\textcolor{magenta}{1}\textcolor{cyan}{)}\\\textcolor{blue}{count}\hsspace \textcolor{magenta}{1}\hsspace {\rm{}cs}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{1}\textcolor{cyan}{,}\textcolor{magenta}{1}\textcolor{cyan}{)}\\\textcolor{blue}{count}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{(}{\rm{}c}\textcolor{red}{{\bf{}:}}{\rm{}cs}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}nL}\hsspace \textcolor{cyan}{+}\hsspace {\rm{}isL}\textcolor{cyan}{,}\hsspace {\rm{}nR}\hsspace \textcolor{cyan}{+}\hsspace {\rm{}isR}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{cyan}{(}{\rm{}nL}\textcolor{cyan}{,}\hsspace {\rm{}nR}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}count}\hsspace \textcolor{cyan}{(}{\rm{}p}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace {\rm{}cs}\\\hstab \textcolor{cyan}{(}{\rm{}isL}\textcolor{cyan}{,}\hsspace {\rm{}isR}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}c}\hsspace \textcolor{green}{\underline{of}}\hsspace {\rm{}L}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{1}\textcolor{cyan}{,}\textcolor{magenta}{0}\textcolor{cyan}{)}\textcolor{cyan}{;}\hsspace {\rm{}R}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{0}\textcolor{cyan}{,}\textcolor{magenta}{1}\textcolor{cyan}{)}\\\\\textcolor{blue}{iso}\hsspace {\rm{}c}\hsspace {\rm{}p}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}genericIndex}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{(}{\rm{}p}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}L}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}fst}\hsspace \textcolor{cyan}{(}{\rm{}count}\hsspace {\rm{}p}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}R}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}snd}\hsspace \textcolor{cyan}{(}{\rm{}count}\hsspace {\rm{}p}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{label}\hsspace \textcolor{red}{=}\hsspace {\rm{}go}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{1}\textcolor{cyan}{,}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}go}\hsspace \textcolor{cyan}{(}{\rm{}l}\textcolor{cyan}{,}{\rm{}r}\textcolor{cyan}{)}\hsspace {\rm{}[]}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}[]}\\\hstab {\rm{}go}\hsspace \textcolor{cyan}{(}{\rm{}l}\textcolor{cyan}{,}{\rm{}r}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{red}{{\bf{}:}}{\rm{}xs}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Left}\hsspace \hsspace {\rm{}l}\hsspace \textcolor{red}{{\bf{}:}}\hsspace {\rm{}go}\hsspace \textcolor{cyan}{(}{\rm{}l}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{,}{\rm{}r}\textcolor{cyan}{)}\hsspace {\rm{}xs}\\\hstab {\rm{}go}\hsspace \textcolor{cyan}{(}{\rm{}l}\textcolor{cyan}{,}{\rm{}r}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}R}\textcolor{red}{{\bf{}:}}{\rm{}xs}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Right}\hsspace {\rm{}r}\hsspace \textcolor{red}{{\bf{}:}}\hsspace {\rm{}go}\hsspace \textcolor{cyan}{(}{\rm{}l}\textcolor{cyan}{,}{\rm{}r}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace {\rm{}xs}\\\\\textcolor{blue}{isoInv}\hsspace {\rm{}c}\hsspace {\rm{}p}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}findIndex}\hsspace \textcolor{cyan}{(}{\rm{}p}\textcolor{cyan}{==}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}label}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{of}}\\\hstab {\rm{}Nothing}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}error}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{magenta}{``went out of bounds while trying to compute index ''}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}show}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{magenta}{`` in complement ''}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}show}\hsspace {\rm{}c}\\\hstab {\rm{}Just}\hsspace {\rm{}i}\hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}toInteger}\hsspace {\rm{}i}\textcolor{cyan}{+}\textcolor{magenta}{1}\\\\\textcolor{blue}{ins}\hsspace {\rm{}p}\hsspace {\rm{}n}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}Rearrange}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}\textcolor{magenta}{1}\hsspace \textcolor{red}{..}\hsspace {\rm{}p}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{red}{]}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}n}\textcolor{cyan}{+}\textcolor{magenta}{1}\textcolor{red}{]}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}p}\textcolor{cyan}{+}\textcolor{magenta}{1}\hsspace \textcolor{red}{..}\hsspace {\rm{}n}\textcolor{red}{]}\textcolor{cyan}{)}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}Insert}\hsspace \textcolor{magenta}{1}\textcolor{red}{]}\\\textcolor{blue}{del}\hsspace {\rm{}p}\hsspace {\rm{}n}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}Delete}\hsspace \textcolor{magenta}{1}\textcolor{cyan}{,}\hsspace {\rm{}Rearrange}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}\textcolor{magenta}{1}\hsspace \textcolor{red}{..}\hsspace {\rm{}p}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{red}{]}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}p}\textcolor{cyan}{+}\textcolor{magenta}{1}\hsspace \textcolor{red}{..}\hsspace {\rm{}n}\textcolor{red}{]}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}p}\textcolor{red}{]}\textcolor{cyan}{)}\textcolor{cyan}{)}\textcolor{red}{]}\\\\\textcolor{blue}{tag}\hsspace {\rm{}L}\hsspace \textcolor{red}{=}\hsspace {\rm{}Left}\\\textcolor{blue}{tag}\hsspace {\rm{}R}\hsspace \textcolor{red}{=}\hsspace {\rm{}Right}\\\\\textcolor{blue}{onL}\hsspace {\rm{}f}\hsspace \textcolor{red}{=}\hsspace {\rm{}either}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}Right}\\\textcolor{blue}{onR}\hsspace {\rm{}f}\hsspace \textcolor{red}{=}\hsspace {\rm{}either}\hsspace {\rm{}Left}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}f}\textcolor{cyan}{)}\\
\section{\texttt{lib/Data/Lens/Edit/Primitive.hs}}
\label{mod:Data.Lens.Edit.Primitive}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Primitive}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Control}\textcolor{cyan}{.}{\rm{}Arrow}\hsspace \textcolor{cyan}{(}{\rm{}first}\textcolor{cyan}{)}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \textcolor{cyan}{(}{\rm{}C}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- needed for GHC 7.2}}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Iso}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}F}\hsspace \textcolor{blue}{{\it{}-- state\_f\_ul}}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateless}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}L}\hsspace \textcolor{blue}{{\it{}-- state\_l\_ess}}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Id}\hsspace {\rm{}dX}\hsspace \textcolor{red}{=}\hsspace {\rm{}Id}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Id}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Id}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dX}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Id}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dX}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Id}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}Id}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}()}\\\hstab {\rm{}missing}\hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace {\rm{}()}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace {\rm{}id}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace {\rm{}id}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Id}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace {\rm{}id}\\\hstab {\rm{}dputl}\hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace {\rm{}id}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}k}\hsspace \textcolor{red}{\tilde{ }}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\hsspace {\rm{}k}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}R}\hsspace {\rm{}l}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}k}\hsspace \textcolor{red}{\tilde{ }}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}missing}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\\\hstab \hstab \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\\\hstab \hstab \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck'}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\\\hstab \hstab \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\\\hstab \hstab \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck'}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}k}\hsspace \textcolor{red}{\tilde{ }}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Compose}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}k}\hsspace \textcolor{red}{\tilde{ }}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\hsspace {\rm{}k}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}R}\hsspace {\rm{}l}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}k}\hsspace \textcolor{red}{\tilde{ }}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}k}\\\hstab {\rm{}missing}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}first}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}ComposeFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}first}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}k}\hsspace \textcolor{red}{\tilde{ }}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\hsspace {\rm{}k}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}R}\hsspace {\rm{}l}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}k}\hsspace \textcolor{red}{\tilde{ }}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\\\hstab {\rm{}missing}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}first}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}ComposeLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}first}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Op}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}Op}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{blue}{unOp}\hsspace \textcolor{cyan}{(}{\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}l}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}R}\hsspace {\rm{}l}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\hsspace {\rm{}l}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\\\hstab {\rm{}missing}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}unOp}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{cyan}{.}\hsspace {\rm{}unOp}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{cyan}{.}\hsspace {\rm{}unOp}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Op}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}unOp}\\\hstab {\rm{}dputl}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}unOp}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Disconnect}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\hsspace \textcolor{red}{=}\hsspace {\rm{}Disconnect}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Disconnect}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Disconnect}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dX}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Disconnect}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dY}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Monoid}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}Monoid}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Disconnect}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}Disconnect}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}()}\\\hstab {\rm{}missing}\hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace {\rm{}()}\\\hstab {\rm{}dputr}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{cyan}{(}\textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}mempty}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{cyan}{(}\textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}mempty}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Monoid}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}Monoid}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Disconnect}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace \textcolor{cyan}{(}{\rm{}const}\hsspace {\rm{}mempty}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace \textcolor{cyan}{(}{\rm{}const}\hsspace {\rm{}mempty}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dX}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dY}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}()}\\\hstab {\rm{}missing}\hsspace \textcolor{red}{=}\hsspace {\rm{}const}\hsspace {\rm{}()}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}f}\hsspace {\rm{}g}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}f}\hsspace {\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}f}\hsspace {\rm{}g}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}g}\hsspace {\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}f}\hsspace {\rm{}g}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}f}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Iso}\hsspace {\rm{}f}\hsspace {\rm{}g}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}g}\\
\section{\texttt{lib/Data/Lens/Edit/Product.hs}}
\label{mod:Data.Lens.Edit.Product}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Product}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Control}\textcolor{cyan}{.}{\rm{}Arrow}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \textcolor{cyan}{(}{\rm{}C}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- needed for GHC 7.2}}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Product}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}F}\hsspace \textcolor{blue}{{\it{}-- state\_f\_ul}}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateless}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}L}\hsspace \textcolor{blue}{{\it{}-- state\_l\_ess}}\\\\\textcolor{blue}{swizzleFF}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}c}\textcolor{cyan}{,}\hsspace {\rm{}d}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}d}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\textcolor{green}{\underline{data}}\hsspace {\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}swizzleFF}\hsspace \textcolor{cyan}{.}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}swizzleFF}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}swizzleFF}\hsspace \textcolor{cyan}{.}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}swizzleFF}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}CompactProduct}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\\\\\textcolor{blue}{swizzleFL}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\\\textcolor{green}{\underline{data}}\hsspace {\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}k}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}swizzleFL}\hsspace \textcolor{cyan}{.}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}swizzleFL}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}swizzleFL}\hsspace \textcolor{cyan}{.}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}swizzleFL}\\\\\textcolor{blue}{swizzleLF}\hsspace \hsspace \hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\textcolor{blue}{unswizzleLF}\hsspace \textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{(}{\rm{}a}\textcolor{cyan}{,}\hsspace {\rm{}b}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\textcolor{green}{\underline{data}}\hsspace {\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}unswizzleLF}\hsspace \textcolor{cyan}{.}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}swizzleLF}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}unswizzleLF}\hsspace \textcolor{cyan}{.}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{***}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}swizzleLF}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ProductAtom}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ProductAtom}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputProductF}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputProductF}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputProductF}\hsspace {\rm{}dputk}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}ck}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputk}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Left}\hsspace \hsspace {\rm{}dz}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck'}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\textcolor{blue}{dputProductF}\hsspace {\rm{}dputk}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}ck}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Right}\hsspace {\rm{}dw}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}either}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Product}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}either}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ProductAtom}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ProductAtom}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}k}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputProductFL}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}ProductFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputProductFL}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputProductFL}\hsspace {\rm{}dputk}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace {\rm{}ck}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputk}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Left}\hsspace {\rm{}dz}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\\\textcolor{blue}{dputProductFL}\hsspace {\rm{}dputk}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace {\rm{}ck}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}dputl}\hsspace {\rm{}dy}\textcolor{cyan}{)}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ProductAtom}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}ProductAtom}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputProductLF}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}ProductLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputProductLF}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputProductLF}\hsspace {\rm{}dputk}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace {\rm{}cl}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Left}\hsspace \textcolor{cyan}{(}{\rm{}dputk}\hsspace {\rm{}dx}\textcolor{cyan}{)}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\\\textcolor{blue}{dputProductLF}\hsspace {\rm{}dputk}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace {\rm{}cl}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}Right}\hsspace {\rm{}dw}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\\
\section{\texttt{lib/Data/Lens/Edit/Stateful.hs}}
\label{mod:Data.Lens.Edit.Stateful}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\\\\\textcolor{green}{\underline{class}}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Lens}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace {\rm{}l}\\\hstab {\rm{}missing}\hsspace \textcolor{red}{::}\hsspace {\rm{}l}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}C}\hsspace {\rm{}l}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{red}{::}\hsspace {\rm{}l}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{red}{::}\hsspace {\rm{}l}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{,}\hsspace {\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{blue}{{\it{}-- Morally, we have}}\\\textcolor{blue}{{\it{}-- foldMap :: Monoid b =\ensuremath{\rangle} (a \ensuremath{\rightarrow} State c b) \ensuremath{\rightarrow} ([a] \ensuremath{\rightarrow} State c b)}}\\\textcolor{blue}{{\it{}-- which does just what we want.  Unfortunately, this requires an}}\\\textcolor{blue}{{\it{}-- instance (Monad m, Monoid a) =\ensuremath{\rangle} Monoid (m a)}}\\\textcolor{blue}{{\it{}-- and an unhealthy amount of type munging to get in and out of State, curry}}\\\textcolor{blue}{{\it{}-- arguments, etc.  Since the instance above is most conveniently available}}\\\textcolor{blue}{{\it{}-- from the "reducers" package, which has a dependency redwood, and the}}\\\textcolor{blue}{{\it{}-- above-mentioned type-munging obfuscates the beautiful definition anyway, we}}\\\textcolor{blue}{{\it{}-- instead re-implement foldMap manually. It's not quite as beautiful}}\\\textcolor{blue}{{\it{}-- conceptually, but it makes for much easier reading.}}\\\\\textcolor{blue}{foldState}\hsspace \textcolor{red}{::}\hsspace {\rm{}Monoid}\hsspace {\rm{}dY}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace \textcolor{cyan}{(}{\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}c}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}dY}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}dX}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}{\rm{}dY}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\textcolor{blue}{foldState}\hsspace {\rm{}f}\hsspace \textcolor{cyan}{(}{\rm{}[]}\hsspace \hsspace \textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}mempty}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\textcolor{blue}{foldState}\hsspace {\rm{}f}\hsspace \textcolor{cyan}{(}{\rm{}e}\textcolor{red}{{\bf{}:}}{\rm{}es}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}mappend}\hsspace {\rm{}e1}\hsspace {\rm{}e2}\textcolor{cyan}{,}\hsspace {\rm{}c''}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{cyan}{(}{\rm{}e2}\textcolor{cyan}{,}\hsspace {\rm{}c'}\hsspace \textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}foldState}\hsspace {\rm{}f}\hsspace \textcolor{cyan}{(}{\rm{}es}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}{\rm{}e1}\textcolor{cyan}{,}\hsspace {\rm{}c''}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}f}\hsspace {\rm{}e}\hsspace {\rm{}c'}\\
\section{\texttt{lib/Data/Lens/Edit/Stateless.hs}}
\label{mod:Data.Lens.Edit.Stateless}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateless}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\\\textcolor{green}{\underline{class}}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Lens}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{red}{::}\hsspace {\rm{}l}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}L}\hsspace {\rm{}l}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}R}\hsspace {\rm{}l}\\\hstab {\rm{}dputl}\hsspace \textcolor{red}{::}\hsspace {\rm{}l}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}R}\hsspace {\rm{}l}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}L}\hsspace {\rm{}l}\\
\section{\texttt{lib/Data/Lens/Edit/Sum.hs}}
\label{mod:Data.Lens.Edit.Sum}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Bidirectional}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \textcolor{cyan}{(}{\rm{}C}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- needed for GHC 7.2}}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateful}\hsspace \hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}F}\hsspace \textcolor{blue}{{\it{}-- state\_f\_ul}}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Lens}\textcolor{cyan}{.}{\rm{}Edit}\textcolor{cyan}{.}{\rm{}Stateless}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}L}\hsspace \textcolor{blue}{{\it{}-- state\_l\_ess}}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}M}\hsspace \textcolor{blue}{{\it{}-- \_m\_odule}}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dx}\hsspace {\rm{}dz}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}retype}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}dy}\hsspace {\rm{}dw}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck'}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \hstab \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}ck}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}cl}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dy}\hsspace {\rm{}dw}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}retype}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}dx}\hsspace {\rm{}dz}\textcolor{cyan}{,}\hsspace \textcolor{cyan}{(}{\rm{}ck'}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \hstab \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}ck}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}cl}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dx}\hsspace {\rm{}dz}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}retype}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\hsspace {\rm{}dz}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}CompactSum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dy}\hsspace {\rm{}dw}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}retype}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\hsspace {\rm{}dw}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}k}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dx}\hsspace {\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\\\hstab \hstab \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}ck}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}retype}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}dy}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\hsspace {\rm{}dz}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}SumFL}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dy}\hsspace {\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\\\hstab \hstab \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}ck}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}retype}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}dx}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\hsspace {\rm{}dw}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}ck'}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}C}\hsspace {\rm{}l}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\\\hstab {\rm{}dputr}\hsspace \textcolor{cyan}{(}{\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dx}\hsspace {\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\\\hstab \hstab \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}cl}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}retype}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace {\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}CompactSumLF}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dy}\hsspace {\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\\\hstab \hstab \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\hsspace \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}M}\textcolor{cyan}{.}{\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}cl}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}retype}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace {\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}cl'}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{red}{=}\hsspace {\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Bidirectional}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}Bidirectional}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Bidirectional}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}L}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}SumAtom}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}L}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}R}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}SumAtom}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}R}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{red}{]}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}k}\textcolor{cyan}{,}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}Lens}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}C}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Either}\hsspace \textcolor{cyan}{(}{\rm{}C}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}C}\hsspace {\rm{}l}\textcolor{cyan}{)}\\\hstab {\rm{}missing}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Left}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{)}\\\hstab {\rm{}dputr}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputSum}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputr}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}dputl}\hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}k}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}F}\textcolor{cyan}{.}{\rm{}foldState}\hsspace \textcolor{cyan}{(}{\rm{}dputSum}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}dputl}\hsspace {\rm{}l}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}k}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}F}\textcolor{cyan}{.}{\rm{}missing}\hsspace {\rm{}l}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{dputSum}\hsspace {\rm{}dputk}\hsspace {\rm{}dputl}\hsspace {\rm{}ck}\hsspace {\rm{}cl}\hsspace {\rm{}dv}\hsspace {\rm{}cv}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace \textcolor{cyan}{(}{\rm{}dv}\textcolor{cyan}{,}\hsspace {\rm{}cv}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{of}}\\\hstab \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}SwitchLL}\hsspace {\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputk}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}SwitchLL}\hsspace {\rm{}dy}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace {\rm{}c'}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}SwitchLR}\hsspace {\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}SwitchLR}\hsspace {\rm{}dw}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace {\rm{}c'}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}SwitchRL}\hsspace {\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputk}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}ck}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}SwitchRL}\hsspace {\rm{}dy}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace {\rm{}c'}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}SwitchRR}\hsspace {\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}cl}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}SwitchRR}\hsspace {\rm{}dw}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace {\rm{}c'}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}StayL}\hsspace \hsspace \hsspace \hsspace {\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dy}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputk}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}StayL}\hsspace \hsspace \hsspace \hsspace {\rm{}dy}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Left}\hsspace \hsspace {\rm{}c'}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}{\rm{}M}\textcolor{cyan}{.}{\rm{}StayR}\hsspace \hsspace \hsspace \hsspace {\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{let}}\hsspace \textcolor{cyan}{(}{\rm{}dw}\textcolor{cyan}{,}\hsspace {\rm{}c'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}dputl}\hsspace \textcolor{cyan}{(}{\rm{}dz}\textcolor{cyan}{,}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{in}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}StayR}\hsspace \hsspace \hsspace \hsspace {\rm{}dw}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}Right}\hsspace {\rm{}c'}\textcolor{cyan}{)}\\\hstab \textcolor{cyan}{(}\textcolor{green}{\underline{\_}}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}M}\textcolor{cyan}{.}{\rm{}FailSum}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}c}\textcolor{cyan}{)}\\
\section{\texttt{lib/Data/Module/Class.hs}}
\label{mod:Data.Module.Class}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies, FlexibleContexts \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Maybe}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\\\\\textcolor{green}{\underline{class}}\hsspace \textcolor{cyan}{(}{\rm{}Default}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}Monoid}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Module}\hsspace {\rm{}dX}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace {\rm{}dX}\\\hstab {\rm{}apply}\hsspace \textcolor{red}{::}\hsspace {\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}V}\hsspace {\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Maybe}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{)}\\\\\textcolor{blue}{applyDef}\hsspace \textcolor{red}{::}\hsspace {\rm{}Module}\hsspace {\rm{}dX}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Maybe}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{)}\\\textcolor{blue}{applyDef}\hsspace {\rm{}dx}\hsspace \textcolor{red}{=}\hsspace {\rm{}apply}\hsspace {\rm{}dx}\hsspace {\rm{}def}\\\\\textcolor{blue}{applyTotal}\hsspace \textcolor{red}{::}\hsspace {\rm{}Module}\hsspace {\rm{}dX}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}V}\hsspace {\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}V}\hsspace {\rm{}dX}\\\textcolor{blue}{applyTotal}\hsspace {\rm{}dx}\hsspace {\rm{}x}\hsspace \textcolor{red}{=}\hsspace {\rm{}fromJust}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dx}\hsspace {\rm{}x}\textcolor{cyan}{)}\\\\\textcolor{blue}{applyDefTotal}\hsspace \textcolor{red}{::}\hsspace {\rm{}Module}\hsspace {\rm{}dX}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}V}\hsspace {\rm{}dX}\\\textcolor{blue}{applyDefTotal}\hsspace {\rm{}dx}\hsspace \textcolor{red}{=}\hsspace {\rm{}applyTotal}\hsspace {\rm{}dx}\hsspace {\rm{}def}\\\\\textcolor{green}{\underline{class}}\hsspace {\rm{}Default}\hsspace \textcolor{cyan}{(}{\rm{}V\_0}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}PartialEdit}\hsspace {\rm{}dX}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V\_0}\hsspace {\rm{}dX}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{red}{::}\hsspace {\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}V\_0}\hsspace {\rm{}dX}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Maybe}\hsspace \textcolor{cyan}{(}{\rm{}V\_0}\hsspace {\rm{}dX}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}PartialEdit}\hsspace {\rm{}dX}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Module}\hsspace \textcolor{red}{[}{\rm{}dX}\textcolor{red}{]}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace \textcolor{red}{[}{\rm{}dX}\textcolor{red}{]}\hsspace \textcolor{red}{=}\hsspace {\rm{}V\_0}\hsspace {\rm{}dX}\\\hstab {\rm{}apply}\hsspace {\rm{}[]}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}v}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace {\rm{}v}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{red}{{\bf{}:}}{\rm{}dxs}\textcolor{cyan}{)}\hsspace {\rm{}v}\hsspace \textcolor{red}{=}\hsspace {\rm{}apply}\hsspace {\rm{}dxs}\hsspace {\rm{}v}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}apply\_0}\hsspace {\rm{}dx}\\
\section{\texttt{lib/Data/Module/Container.hs}}
\label{mod:Data.Module.Container}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Container}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Container}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Set}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}S}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}ContainerAtom}\hsspace {\rm{}shape}\hsspace {\rm{}dX}\\\hstab \textcolor{red}{=}\hsspace {\rm{}FailContainer}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Modify}\hsspace \textcolor{cyan}{(}{\rm{}P}\hsspace {\rm{}shape}\textcolor{cyan}{)}\hsspace {\rm{}dX}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Insert}\hsspace \textcolor{cyan}{(}{\rm{}ShapeModule}\hsspace {\rm{}shape}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- a non-decreasing edit to the shape}}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Delete}\hsspace \textcolor{cyan}{(}{\rm{}ShapeModule}\hsspace {\rm{}shape}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- a non-increasing edit to the shape}}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Rearrange}\hsspace \textcolor{cyan}{(}{\rm{}ShapeModule}\hsspace {\rm{}shape}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}shape}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}P}\hsspace {\rm{}shape}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}P}\hsspace {\rm{}shape}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- a shape edit which doesn't change the number of positions, and a function translating positions in the new structure to their corresponding position in the old structure}}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Show}\hsspace \textcolor{cyan}{(}{\rm{}P}\hsspace {\rm{}shape}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}Show}\hsspace \textcolor{cyan}{(}{\rm{}ShapeModule}\hsspace {\rm{}shape}\textcolor{cyan}{)}\textcolor{cyan}{,}\hsspace {\rm{}Show}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Show}\hsspace \textcolor{cyan}{(}{\rm{}ContainerAtom}\hsspace {\rm{}shape}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}showsPrec}\hsspace {\rm{}d}\hsspace {\rm{}FailContainer}\hsspace \textcolor{red}{=}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{``FailContainer''}\\\hstab {\rm{}showsPrec}\hsspace {\rm{}d}\hsspace \textcolor{cyan}{(}{\rm{}Modify}\hsspace {\rm{}pos}\hsspace {\rm{}dx}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{=}\hsspace {\rm{}showParen}\hsspace \textcolor{cyan}{(}{\rm{}d}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace \textcolor{magenta}{10}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{cyan}{\$}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{``Modify ''}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showsPrec}\hsspace \textcolor{magenta}{11}\hsspace {\rm{}pos}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{`` ''}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showsPrec}\hsspace \textcolor{magenta}{11}\hsspace {\rm{}dx}\\\hstab {\rm{}showsPrec}\hsspace {\rm{}d}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace {\rm{}ds}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{=}\hsspace {\rm{}showParen}\hsspace \textcolor{cyan}{(}{\rm{}d}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace \textcolor{magenta}{10}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{cyan}{\$}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{``Insert ''}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showsPrec}\hsspace \textcolor{magenta}{11}\hsspace {\rm{}ds}\\\hstab {\rm{}showsPrec}\hsspace {\rm{}d}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}ds}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{=}\hsspace {\rm{}showParen}\hsspace \textcolor{cyan}{(}{\rm{}d}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace \textcolor{magenta}{10}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{cyan}{\$}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{``Delete ''}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showsPrec}\hsspace \textcolor{magenta}{11}\hsspace {\rm{}ds}\\\hstab {\rm{}showsPrec}\hsspace {\rm{}d}\hsspace \textcolor{cyan}{(}{\rm{}Rearrange}\hsspace {\rm{}ds}\hsspace {\rm{}f}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{=}\hsspace {\rm{}showParen}\hsspace \textcolor{cyan}{(}{\rm{}d}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace \textcolor{magenta}{10}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{cyan}{\$}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{``Rearrange ''}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showsPrec}\hsspace \textcolor{magenta}{11}\hsspace {\rm{}ds}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{`` \ensuremath{\langle}fn\ensuremath{\rangle}''}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}ContainerType}\hsspace {\rm{}shape}\textcolor{cyan}{,}\hsspace {\rm{}Module}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}PartialEdit}\hsspace \textcolor{cyan}{(}{\rm{}ContainerAtom}\hsspace {\rm{}shape}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V\_0}\hsspace \textcolor{cyan}{(}{\rm{}ContainerAtom}\hsspace {\rm{}shape}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Container}\hsspace {\rm{}shape}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}FailContainer}\hsspace \textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}Nothing}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Modify}\hsspace \hsspace \hsspace \hsspace {\rm{}p}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace \textcolor{cyan}{(}\textcolor{red}{$\backslash$}{\rm{}x}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}replace}\hsspace {\rm{}p}\hsspace {\rm{}x}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dx}\hsspace \textcolor{cyan}{(}{\rm{}containedValues}\hsspace {\rm{}c}\hsspace {\rm{}p}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace \hsspace \hsspace \hsspace {\rm{}ds}\hsspace \hsspace \textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace \textcolor{cyan}{(}\textcolor{red}{$\backslash$}{\rm{}shape}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}expand}\hsspace \hsspace \hsspace \hsspace {\rm{}shape}\hsspace {\rm{}def}\hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}ds}\hsspace \textcolor{cyan}{(}{\rm{}currentShape}\hsspace \hsspace \hsspace \hsspace {\rm{}c}\hsspace \hsspace \textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace \hsspace \hsspace \hsspace {\rm{}ds}\hsspace \hsspace \textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace \textcolor{cyan}{(}\textcolor{red}{$\backslash$}{\rm{}shape}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}setShape}\hsspace \hsspace {\rm{}shape}\hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}ds}\hsspace \textcolor{cyan}{(}{\rm{}currentShape}\hsspace \hsspace \hsspace \hsspace {\rm{}c}\hsspace \hsspace \textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Rearrange}\hsspace {\rm{}ds}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace \textcolor{cyan}{(}\textcolor{red}{$\backslash$}{\rm{}shape}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}reorder}\hsspace {\rm{}f}\hsspace {\rm{}shape}\hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}c}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}ds}\hsspace \textcolor{cyan}{(}{\rm{}currentShape}\hsspace \hsspace \hsspace \hsspace {\rm{}c}\hsspace \hsspace \textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{blue}{expand}\hsspace {\rm{}shape'}\hsspace {\rm{}x}\hsspace \textcolor{cyan}{(}{\rm{}Container}\hsspace {\rm{}shape}\hsspace {\rm{}values}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Container}\hsspace {\rm{}shape'}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{red}{$\backslash$}{\rm{}p}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\\\hstab \textcolor{green}{\underline{if}}\hsspace {\rm{}S}\textcolor{cyan}{.}{\rm{}member}\hsspace {\rm{}p}\hsspace \textcolor{cyan}{(}{\rm{}live}\hsspace {\rm{}shape}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{then}}\hsspace {\rm{}values}\hsspace {\rm{}p}\\\hstab \textcolor{green}{\underline{else}}\hsspace {\rm{}x}\\\\\textcolor{blue}{setShape}\hsspace {\rm{}shape}\hsspace {\rm{}c}\hsspace \textcolor{red}{=}\hsspace {\rm{}c}\hsspace \textcolor{cyan}{\{}\hsspace {\rm{}currentShape}\hsspace \textcolor{red}{=}\hsspace {\rm{}shape}\hsspace \textcolor{cyan}{\}}\\\textcolor{blue}{reorder}\hsspace {\rm{}f}\hsspace {\rm{}shape'}\hsspace \textcolor{cyan}{(}{\rm{}Container}\hsspace {\rm{}shape}\hsspace {\rm{}values}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Container}\hsspace {\rm{}shape'}\hsspace \textcolor{cyan}{(}{\rm{}values}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}f}\hsspace {\rm{}shape}\textcolor{cyan}{)}\\
\section{\texttt{lib/Data/Module/List.hs}}
\label{mod:Data.Module.List}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}List}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Control}\textcolor{cyan}{.}{\rm{}Monad}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}List}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\\\textcolor{blue}{{\it{}-- in the Simple variant, the elements of the list tell which index the}}\\\textcolor{blue}{{\it{}-- corresponding element in the output list should come from, e.g.}}\\\textcolor{blue}{{\it{}--}}\\\textcolor{blue}{{\it{}-- applyPermutation (Simple is) [1..length is] = is}}\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Permutation}\hsspace \textcolor{red}{=}\hsspace {\rm{}Simple}\hsspace \textcolor{red}{[}{\rm{}Integer}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Complex}\hsspace \textcolor{cyan}{(}{\rm{}Integer}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Integer}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Integer}\textcolor{cyan}{)}\\\\\textcolor{blue}{applyPermutation}\hsspace \textcolor{red}{::}\hsspace {\rm{}Permutation}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{red}{[}{\rm{}a}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{red}{[}{\rm{}a}\textcolor{red}{]}\\\textcolor{blue}{applyPermutation}\hsspace \textcolor{cyan}{(}{\rm{}Complex}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}xs}\hsspace \textcolor{red}{=}\hsspace {\rm{}result}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}result}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}genericIndex}\hsspace {\rm{}xs}\hsspace \textcolor{cyan}{(}{\rm{}f}\hsspace {\rm{}n}\hsspace {\rm{}i}\hsspace \textcolor{blue}{{\it{}-}}\hsspace \textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace \textcolor{red}{[}\textcolor{magenta}{1}\textcolor{red}{..}{\rm{}n}\textcolor{red}{]}\textcolor{red}{]}\\\hstab {\rm{}n}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}genericLength}\hsspace {\rm{}xs}\\\textcolor{blue}{applyPermutation}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace {\rm{}is}\textcolor{cyan}{)}\hsspace {\rm{}xs}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}length}\hsspace {\rm{}xs}\hsspace \textcolor{cyan}{\ensuremath{\langle}}\hsspace {\rm{}length}\hsspace {\rm{}is}\hsspace \textcolor{red}{=}\hsspace {\rm{}xs}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}otherwise}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}\textcolor{red}{$\backslash$}{\rm{}i}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}genericIndex}\hsspace {\rm{}xs}\hsspace \textcolor{cyan}{(}{\rm{}i}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace {\rm{}is}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}drop}\hsspace \textcolor{cyan}{(}{\rm{}length}\hsspace {\rm{}is}\textcolor{cyan}{)}\hsspace {\rm{}xs}\\\\\textcolor{blue}{complexPermutation}\hsspace \textcolor{red}{::}\hsspace {\rm{}Permutation}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Integer}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Integer}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Integer}\\\textcolor{blue}{complexPermutation}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace {\rm{}is}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{$\backslash$}{\rm{}n}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}()}\hsspace \textcolor{green}{\underline{of}}\\\hstab \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{\ensuremath{\langle}}\hsspace {\rm{}len}\hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}i}\\\hstab \hsspace \hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}i}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace {\rm{}len}\hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}i}\\\hstab \hsspace \hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}i}\hsspace \textcolor{cyan}{\ensuremath{\rangle}}\hsspace {\rm{}n}\hsspace \hsspace \hsspace \hsspace \hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}error}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{``asked a premutation for the origin of position ''}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}show}\hsspace {\rm{}i}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{magenta}{``, but the permutation is of a list of length only ''}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}show}\hsspace {\rm{}n}\textcolor{cyan}{)}\\\hstab \hsspace \hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}otherwise}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}genericIndex}\hsspace {\rm{}is}\hsspace \textcolor{cyan}{(}{\rm{}i}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{where}}\hsspace {\rm{}len}\hsspace \textcolor{red}{=}\hsspace {\rm{}genericLength}\hsspace {\rm{}is}\\\textcolor{blue}{complexPermutation}\hsspace \textcolor{cyan}{(}{\rm{}Complex}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}f}\\\\\textcolor{blue}{simplePermutation}\hsspace \textcolor{red}{::}\hsspace {\rm{}Permutation}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Integer}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{red}{[}{\rm{}Integer}\textcolor{red}{]}\\\textcolor{blue}{simplePermutation}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace {\rm{}is}\textcolor{cyan}{)}\hsspace {\rm{}n}\hsspace \textcolor{red}{=}\hsspace {\rm{}is}\\\textcolor{blue}{simplePermutation}\hsspace \textcolor{cyan}{(}{\rm{}Complex}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace {\rm{}n}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}f}\hsspace {\rm{}n}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace \textcolor{red}{[}\textcolor{magenta}{1}\hsspace \textcolor{red}{..}\hsspace {\rm{}n}\textcolor{red}{]}\textcolor{red}{]}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Show}\hsspace {\rm{}Permutation}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}showsPrec}\hsspace {\rm{}d}\hsspace \textcolor{cyan}{(}{\rm{}Complex}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{``\ensuremath{\langle}fn\ensuremath{\rangle}''}\\\hstab {\rm{}showsPrec}\hsspace {\rm{}d}\hsspace \textcolor{cyan}{(}{\rm{}Simple}\hsspace {\rm{}ns}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{red}{=}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{``[''}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showString}\hsspace \textcolor{cyan}{(}{\rm{}intercalate}\hsspace \textcolor{magenta}{``, ''}\hsspace \textcolor{cyan}{(}{\rm{}zipWith}\hsspace \textcolor{cyan}{(}\textcolor{red}{$\backslash$}{\rm{}n}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}show}\hsspace {\rm{}n}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{magenta}{``\ensuremath{\rightarrow}''}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}show}\hsspace {\rm{}i}\textcolor{cyan}{)}\hsspace {\rm{}ns}\hsspace \textcolor{red}{[}\textcolor{magenta}{1}\textcolor{red}{..}\textcolor{red}{]}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{cyan}{.}\hsspace {\rm{}showString}\hsspace \textcolor{magenta}{``]''}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}ListAtom}\hsspace {\rm{}dX}\\\hstab \textcolor{red}{=}\hsspace {\rm{}FailList}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Modify}\hsspace {\rm{}Integer}\hsspace {\rm{}dX}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Insert}\hsspace {\rm{}Integer}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Delete}\hsspace {\rm{}Integer}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}Rearrange}\hsspace {\rm{}Permutation}\\\hstab \textcolor{green}{\underline{deriving}}\hsspace {\rm{}Show}\\\\\textcolor{blue}{split3}\hsspace \textcolor{red}{::}\hsspace {\rm{}Integer}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{red}{[}{\rm{}a}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Maybe}\hsspace \textcolor{cyan}{(}\textcolor{red}{[}{\rm{}a}\textcolor{red}{]}\textcolor{cyan}{,}\hsspace {\rm{}a}\textcolor{cyan}{,}\hsspace \textcolor{red}{[}{\rm{}a}\textcolor{red}{]}\textcolor{cyan}{)}\\\textcolor{blue}{split3}\hsspace {\rm{}i}\hsspace {\rm{}xs}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}i}\hsspace \textcolor{cyan}{\ensuremath{\langle}}\hsspace \textcolor{magenta}{1}\hsspace \textcolor{red}{=}\hsspace {\rm{}Nothing}\\\textcolor{blue}{split3}\hsspace {\rm{}i}\hsspace {\rm{}xs}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}genericSplitAt}\hsspace \textcolor{cyan}{(}{\rm{}i}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{cyan}{)}\hsspace {\rm{}xs}\hsspace \textcolor{green}{\underline{of}}\\\hstab \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}x}\textcolor{red}{{\bf{}:}}{\rm{}e}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Just}\hsspace \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}x}\textcolor{cyan}{,}\hsspace {\rm{}e}\textcolor{cyan}{)}\\\hstab \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Nothing}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Module}\hsspace {\rm{}dX}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}PartialEdit}\hsspace \textcolor{cyan}{(}{\rm{}ListAtom}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V\_0}\hsspace \textcolor{cyan}{(}{\rm{}ListAtom}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}V}\hsspace {\rm{}dX}\textcolor{red}{]}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Modify}\hsspace {\rm{}p}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace {\rm{}xs}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{do}}\\\hstab \hstab \textcolor{cyan}{(}{\rm{}b}\textcolor{cyan}{,}\hsspace {\rm{}x}\textcolor{cyan}{,}\hsspace {\rm{}e}\textcolor{cyan}{)}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}split3}\hsspace {\rm{}p}\hsspace {\rm{}xs}\\\hstab \hstab {\rm{}x'}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace {\rm{}apply}\hsspace {\rm{}dx}\hsspace {\rm{}x}\\\hstab \hstab {\rm{}return}\hsspace \textcolor{cyan}{(}{\rm{}b}\hsspace \textcolor{cyan}{++}\hsspace \textcolor{red}{[}{\rm{}x'}\textcolor{red}{]}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}e}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Insert}\hsspace {\rm{}i}\textcolor{cyan}{)}\hsspace {\rm{}xs}\hsspace \textcolor{red}{=}\hsspace {\rm{}return}\hsspace \textcolor{cyan}{(}{\rm{}xs}\hsspace \textcolor{cyan}{++}\hsspace {\rm{}genericReplicate}\hsspace {\rm{}i}\hsspace {\rm{}def}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Delete}\hsspace {\rm{}i}\textcolor{cyan}{)}\hsspace {\rm{}xs}\hsspace \textcolor{red}{=}\hsspace \textcolor{green}{\underline{do}}\\\hstab \hstab {\rm{}guard}\hsspace \textcolor{cyan}{(}\textcolor{magenta}{0}\hsspace \textcolor{cyan}{\ensuremath{\langle}=}\hsspace {\rm{}i}\hsspace \textcolor{cyan}{\&\&}\hsspace {\rm{}i}\hsspace \textcolor{cyan}{\ensuremath{\langle}=}\hsspace {\rm{}genericLength}\hsspace {\rm{}xs}\textcolor{cyan}{)}\\\hstab \hstab {\rm{}return}\hsspace \textcolor{cyan}{(}{\rm{}zipWith}\hsspace {\rm{}const}\hsspace {\rm{}xs}\hsspace \textcolor{cyan}{(}{\rm{}genericDrop}\hsspace {\rm{}i}\hsspace {\rm{}xs}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Rearrange}\hsspace {\rm{}perm}\textcolor{cyan}{)}\hsspace {\rm{}xs}\hsspace \textcolor{red}{=}\hsspace {\rm{}return}\hsspace \textcolor{cyan}{(}{\rm{}applyPermutation}\hsspace {\rm{}perm}\hsspace {\rm{}xs}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}Nothing}\\
\section{\texttt{lib/Data/Module/Primitive.hs}}
\label{mod:Data.Module.Primitive}
\textcolor{blue}{{\it{}\{-\# LANGUAGE GeneralizedNewtypeDeriving, TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Primitive}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\\\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}Unit}\hsspace {\rm{}x}\hsspace \textcolor{red}{=}\hsspace {\rm{}Unit}\hsspace {\rm{}()}\hsspace \textcolor{green}{\underline{deriving}}\hsspace {\rm{}Monoid}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Default}\hsspace {\rm{}x}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}Unit}\hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}Unit}\hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}x}\\\hstab {\rm{}apply}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Default}\hsspace {\rm{}x}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}First}\hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}First}\hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}x}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}First}\hsspace {\rm{}Nothing}\hsspace \hsspace \textcolor{cyan}{)}\hsspace {\rm{}x}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace {\rm{}x}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}First}\hsspace \textcolor{cyan}{(}{\rm{}Just}\hsspace {\rm{}x'}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace {\rm{}x}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace {\rm{}x'}\\
\section{\texttt{lib/Data/Module/Product.hs}}
\label{mod:Data.Module.Product}
\textcolor{blue}{{\it{}\{-\# LANGUAGE TypeFamilies, TypeSynonymInstances \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Product}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Control}\textcolor{cyan}{.}{\rm{}Monad}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Module}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}Module}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}V}\hsspace {\rm{}dY}\textcolor{cyan}{)}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}dx}\textcolor{cyan}{,}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}x}\textcolor{cyan}{,}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}liftM2}\hsspace {\rm{}(,)}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dx}\hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dy}\hsspace {\rm{}y}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{type}}\hsspace {\rm{}ProductAtom}\hsspace \textcolor{red}{=}\hsspace {\rm{}Either}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Module}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}Module}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}PartialEdit}\hsspace \textcolor{cyan}{(}{\rm{}ProductAtom}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V\_0}\hsspace \textcolor{cyan}{(}{\rm{}ProductAtom}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}V}\hsspace {\rm{}dY}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}x}\textcolor{cyan}{,}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}liftM2}\hsspace {\rm{}(,)}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dx}\hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}return}\hsspace \hsspace \hsspace {\rm{}y}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}x}\textcolor{cyan}{,}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}liftM2}\hsspace {\rm{}(,)}\hsspace \textcolor{cyan}{(}{\rm{}return}\hsspace \hsspace \hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dy}\hsspace {\rm{}y}\textcolor{cyan}{)}\\
\section{\texttt{lib/Data/Module/Shape.hs}}
\label{mod:Data.Module.Shape}
\textcolor{blue}{{\it{}\{-\# LANGUAGE FlexibleInstances, TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Shape}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Algebra}\textcolor{cyan}{.}{\rm{}PartialOrd}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Container}\\\textcolor{green}{\underline{import}}\hsspace \textcolor{green}{\underline{qualified}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Set}\hsspace \textcolor{green}{\underline{as}}\hsspace {\rm{}S}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}Int}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}Int}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Int}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}di}\textcolor{cyan}{)}\hsspace {\rm{}i}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace \textcolor{cyan}{(}{\rm{}max}\hsspace \textcolor{magenta}{0}\hsspace \textcolor{cyan}{(}{\rm{}di}\hsspace \textcolor{cyan}{+}\hsspace {\rm{}i}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{blue}{{\it{}-- Okay, doesn't quite obey the laws, what with overflow and all.}}\\\textcolor{green}{\underline{type}}\hsspace \textcolor{green}{\underline{instance}}\hsspace {\rm{}ShapeModule}\hsspace {\rm{}Int}\hsspace \textcolor{red}{=}\hsspace {\rm{}Sum}\hsspace {\rm{}Int}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}PartialOrd}\hsspace {\rm{}Int}\hsspace \textcolor{green}{\underline{where}}\hsspace {\rm{}leq}\hsspace \textcolor{red}{=}\hsspace \textcolor{cyan}{(}\textcolor{cyan}{\ensuremath{\langle}=}\textcolor{cyan}{)}\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}ContainerType}\hsspace {\rm{}Int}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}P}\hsspace {\rm{}Int}\hsspace \textcolor{red}{=}\hsspace {\rm{}Int}\\\hstab {\rm{}live}\hsspace {\rm{}i}\hsspace \textcolor{red}{=}\hsspace {\rm{}S}\textcolor{cyan}{.}{\rm{}fromAscList}\hsspace \textcolor{red}{[}\textcolor{magenta}{0}\textcolor{red}{..}{\rm{}i}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{red}{]}\\\\\textcolor{blue}{listToContainer}\hsspace \textcolor{red}{::}\hsspace \textcolor{red}{[}{\rm{}a}\textcolor{red}{]}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}Container}\hsspace {\rm{}Int}\hsspace {\rm{}a}\\\textcolor{blue}{containerToList}\hsspace \textcolor{red}{::}\hsspace {\rm{}Container}\hsspace {\rm{}Int}\hsspace {\rm{}a}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace \textcolor{red}{[}{\rm{}a}\textcolor{red}{]}\\\textcolor{blue}{listToContainer}\hsspace \textcolor{green}{\underline{as}}\hsspace \textcolor{red}{=}\hsspace {\rm{}Container}\hsspace \textcolor{cyan}{(}{\rm{}length}\hsspace \textcolor{green}{\underline{as}}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}\textcolor{green}{\underline{as}}\textcolor{cyan}{!!}\textcolor{cyan}{)}\\\textcolor{blue}{containerToList}\hsspace {\rm{}c}\hsspace \hsspace \textcolor{red}{=}\hsspace \textcolor{red}{[}{\rm{}containedValues}\hsspace {\rm{}c}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}i}\hsspace \textcolor{red}{\ensuremath{\leftarrow}}\hsspace \textcolor{red}{[}\textcolor{magenta}{0}\textcolor{red}{..}{\rm{}currentShape}\hsspace {\rm{}c}\textcolor{blue}{{\it{}-}}\textcolor{magenta}{1}\textcolor{red}{]}\textcolor{red}{]}\\
\section{\texttt{lib/Data/Module/Sum.hs}}
\label{mod:Data.Module.Sum}
\textcolor{blue}{{\it{}\{-\# LANGUAGE GeneralizedNewtypeDeriving, TypeFamilies \#-\}}}\\\textcolor{green}{\underline{module}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Sum}\hsspace \textcolor{green}{\underline{where}}\\\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Default}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Module}\textcolor{cyan}{.}{\rm{}Class}\\\textcolor{green}{\underline{import}}\hsspace {\rm{}Data}\textcolor{cyan}{.}{\rm{}Monoid}\hsspace {\rm{}hiding}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\textcolor{cyan}{(}\textcolor{red}{..}\textcolor{cyan}{)}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Default}\hsspace {\rm{}x}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Default}\hsspace \textcolor{cyan}{(}{\rm{}Either}\hsspace {\rm{}x}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}def}\hsspace \textcolor{red}{=}\hsspace {\rm{}Left}\hsspace {\rm{}def}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Tag}\hsspace \textcolor{red}{=}\hsspace {\rm{}L}\hsspace \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}R}\hsspace \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Bounded}\textcolor{cyan}{,}\hsspace {\rm{}Enum}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\textcolor{green}{\underline{newtype}}\hsspace {\rm{}Retag}\hsspace {\rm{}x}\hsspace {\rm{}y}\hsspace \textcolor{red}{=}\hsspace {\rm{}Retag}\hsspace \textcolor{cyan}{(}{\rm{}Maybe}\hsspace \textcolor{cyan}{(}{\rm{}Endo}\hsspace {\rm{}Tag}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{deriving}}\hsspace {\rm{}Monoid}\\\\\textcolor{blue}{retype}\hsspace \textcolor{cyan}{(}{\rm{}Retag}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Retag}\hsspace {\rm{}f}\\\textcolor{blue}{bool}\hsspace \textcolor{cyan}{(}{\rm{}Retag}\hsspace {\rm{}Nothing}\textcolor{cyan}{)}\hsspace {\rm{}nothing}\hsspace {\rm{}just}\hsspace \textcolor{red}{=}\hsspace {\rm{}nothing}\\\textcolor{blue}{bool}\hsspace \textcolor{green}{\underline{\_}}\hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace \hsspace {\rm{}nothing}\hsspace {\rm{}just}\hsspace \textcolor{red}{=}\hsspace {\rm{}just}\\\\\textcolor{green}{\underline{instance}}\hsspace {\rm{}Eq}\hsspace \textcolor{cyan}{(}{\rm{}Retag}\hsspace {\rm{}x}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}Retag}\hsspace {\rm{}Nothing}\hsspace \hsspace \textcolor{cyan}{==}\hsspace {\rm{}Retag}\hsspace {\rm{}Nothing}\hsspace \hsspace \hsspace \textcolor{red}{=}\hsspace {\rm{}True}\\\hstab {\rm{}Retag}\hsspace \textcolor{cyan}{(}{\rm{}Just}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{==}\hsspace {\rm{}Retag}\hsspace \textcolor{cyan}{(}{\rm{}Just}\hsspace {\rm{}f'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}appEndo}\hsspace {\rm{}f}\textcolor{cyan}{)}\hsspace \textcolor{red}{[}{\rm{}L}\textcolor{cyan}{,}\hsspace {\rm{}R}\textcolor{red}{]}\hsspace \textcolor{cyan}{==}\hsspace {\rm{}map}\hsspace \textcolor{cyan}{(}{\rm{}appEndo}\hsspace {\rm{}f'}\textcolor{cyan}{)}\hsspace \textcolor{red}{[}{\rm{}L}\textcolor{cyan}{,}\hsspace {\rm{}R}\textcolor{red}{]}\\\hstab \textcolor{green}{\underline{\_}}\hsspace \textcolor{cyan}{==}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}False}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Default}\hsspace {\rm{}x}\textcolor{cyan}{,}\hsspace {\rm{}Default}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}Retag}\hsspace {\rm{}x}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}Retag}\hsspace {\rm{}x}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Either}\hsspace {\rm{}x}\hsspace {\rm{}y}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}Retag}\hsspace {\rm{}Nothing}\textcolor{cyan}{)}\hsspace {\rm{}v}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace {\rm{}v}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}Retag}\hsspace \textcolor{cyan}{(}{\rm{}Just}\hsspace \textcolor{cyan}{(}{\rm{}Endo}\hsspace {\rm{}f}\textcolor{cyan}{)}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace {\rm{}v}\hsspace \textcolor{red}{=}\hsspace {\rm{}Just}\hsspace \textcolor{cyan}{\$}\hsspace \textcolor{green}{\underline{case}}\hsspace {\rm{}v}\hsspace \textcolor{green}{\underline{of}}\\\hstab \hstab {\rm{}Left}\hsspace \hsspace {\rm{}x}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}redef}\hsspace \textcolor{cyan}{(}{\rm{}f}\hsspace {\rm{}L}\textcolor{cyan}{)}\\\hstab \hstab {\rm{}Right}\hsspace {\rm{}y}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}redef}\hsspace \textcolor{cyan}{(}{\rm{}f}\hsspace {\rm{}R}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{green}{\underline{where}}\\\hstab \hstab {\rm{}redef}\hsspace {\rm{}L}\hsspace \textcolor{red}{=}\hsspace {\rm{}Left}\hsspace \hsspace {\rm{}def}\\\hstab \hstab {\rm{}redef}\hsspace {\rm{}R}\hsspace \textcolor{red}{=}\hsspace {\rm{}Right}\hsspace {\rm{}def}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}Sum}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\hsspace \textcolor{red}{=}\hsspace {\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}Retag}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dY}\textcolor{cyan}{)}\textcolor{cyan}{)}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Monoid}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}Monoid}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Monoid}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab {\rm{}mempty}\hsspace \textcolor{red}{=}\hsspace {\rm{}Sum}\hsspace {\rm{}mempty}\hsspace {\rm{}mempty}\hsspace {\rm{}mempty}\\\hstab {\rm{}mappend}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dx}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}f'}\hsspace {\rm{}dx'}\hsspace {\rm{}dy'}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\\\hstab \hstab {\rm{}Sum}\hsspace \textcolor{cyan}{(}{\rm{}mappend}\hsspace {\rm{}f}\hsspace {\rm{}f'}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}annihilate}\hsspace {\rm{}dx}\hsspace {\rm{}dx'}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}annihilate}\hsspace {\rm{}dy}\hsspace {\rm{}dy'}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \hstab {\rm{}annihilate}\hsspace \textcolor{red}{::}\hsspace {\rm{}Monoid}\hsspace {\rm{}d}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}d}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}d}\hsspace \textcolor{red}{\ensuremath{\rightarrow}}\hsspace {\rm{}d}\\\hstab \hstab {\rm{}annihilate}\hsspace {\rm{}d}\hsspace {\rm{}d'}\hsspace \textcolor{red}{=}\hsspace {\rm{}bool}\hsspace {\rm{}f}\hsspace {\rm{}d}\hsspace \textcolor{cyan}{(}{\rm{}mappend}\hsspace {\rm{}d}\hsspace {\rm{}d'}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Module}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}Module}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}Module}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Either}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dY}\textcolor{cyan}{)}\\\hstab {\rm{}apply}\hsspace \textcolor{cyan}{(}{\rm{}Sum}\hsspace {\rm{}f}\hsspace {\rm{}dx}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace {\rm{}v}\hsspace \textcolor{red}{=}\hsspace {\rm{}apply}\hsspace {\rm{}f}\hsspace {\rm{}v}\hsspace \textcolor{cyan}{\ensuremath{\rangle}\ensuremath{\rangle}=}\hsspace {\rm{}either}\\\hstab \hstab \textcolor{cyan}{(}{\rm{}fmap}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{.}\hsspace {\rm{}apply}\hsspace {\rm{}dx}\textcolor{cyan}{)}\\\hstab \hstab \textcolor{cyan}{(}{\rm{}fmap}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{.}\hsspace {\rm{}apply}\hsspace {\rm{}dy}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{data}}\hsspace {\rm{}SumAtom}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\\\hstab \textcolor{red}{=}\hsspace {\rm{}FailSum}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}SwitchLL}\hsspace {\rm{}dX}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}SwitchLR}\hsspace {\rm{}dY}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}SwitchRL}\hsspace {\rm{}dX}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}SwitchRR}\hsspace {\rm{}dY}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}StayL}\hsspace {\rm{}dX}\\\hstab \textcolor{red}{\ensuremath{|}}\hsspace {\rm{}StayR}\hsspace {\rm{}dY}\\\hstab \textcolor{green}{\underline{deriving}}\hsspace \textcolor{cyan}{(}{\rm{}Eq}\textcolor{cyan}{,}\hsspace {\rm{}Ord}\textcolor{cyan}{,}\hsspace {\rm{}Show}\textcolor{cyan}{,}\hsspace {\rm{}Read}\textcolor{cyan}{)}\\\\\textcolor{green}{\underline{instance}}\hsspace \textcolor{cyan}{(}{\rm{}Module}\hsspace {\rm{}dX}\textcolor{cyan}{,}\hsspace {\rm{}Module}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=\ensuremath{\rangle}}\hsspace {\rm{}PartialEdit}\hsspace \textcolor{cyan}{(}{\rm{}SumAtom}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{green}{\underline{where}}\\\hstab \textcolor{green}{\underline{type}}\hsspace {\rm{}V\_0}\hsspace \textcolor{cyan}{(}{\rm{}SumAtom}\hsspace {\rm{}dX}\hsspace {\rm{}dY}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}Either}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dX}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}V}\hsspace {\rm{}dY}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}SwitchLL}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dx}\hsspace {\rm{}x}\hsspace \hsspace \textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}SwitchLR}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dy}\hsspace {\rm{}def}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}SwitchRL}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dx}\hsspace {\rm{}def}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}SwitchRR}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dy}\hsspace {\rm{}y}\hsspace \hsspace \textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}StayL}\hsspace {\rm{}dx}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Left}\hsspace \hsspace {\rm{}x}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace {\rm{}Left}\hsspace \hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dx}\hsspace {\rm{}x}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{cyan}{(}{\rm{}StayR}\hsspace {\rm{}dy}\textcolor{cyan}{)}\hsspace \textcolor{cyan}{(}{\rm{}Right}\hsspace {\rm{}y}\textcolor{cyan}{)}\hsspace \textcolor{red}{=}\hsspace {\rm{}fmap}\hsspace {\rm{}Right}\hsspace \textcolor{cyan}{(}{\rm{}apply}\hsspace {\rm{}dy}\hsspace {\rm{}y}\textcolor{cyan}{)}\\\hstab {\rm{}apply\_0}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{green}{\underline{\_}}\hsspace \textcolor{red}{=}\hsspace {\rm{}Nothing}\\
