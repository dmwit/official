% TODO: don't forget the stuff listed in the TODO file
% TODO: comments from Dave
%   * include your middle initial
%   * indent first paragraphs of sections
\documentclass[12pt]{report}
\usepackage{paper}
\usepackage[top=1in,bottom=1in,left=1.5in,right=1in,includefoot,paperwidth=8.5in,paperheight=11in]{geometry}
\usepackage[numbers,sort&compress]{natbib}
\pagestyle{plain}

\numberwithin{equation}{section}

\doublespacing
\def\thetitle{\uppercase{Symmetric Edit Lenses:\\A New Foundation For Bidirectional Languages}}
\def\theauthor{Daniel Wagner}
\def\theadvisor{Benjamin C. Pierce}
\def\theyear{2014}
\begin{document}
\pagenumbering{roman}
\doublespacing
\large\newlength{\oldparskip}\setlength\oldparskip{\parskip}\parskip=.2in
\thispagestyle{empty}
\vspace*{\fill}
\begin{center}
\thetitle

\theauthor

\singlespacing
A dissertation in Computer and Information Sciences, \\
presented to the faculties of the University of Pennsylvania in partial
fulfillment of the requirements for the degree of Doctor of Philosophy.

\doublespacing
\theyear
\end{center}

\vspace*{3ex}

\singlespacing
\noindent\makebox[0in][l]{\rule[2ex]{3.5in}{.3mm}}%
Supervisor: \theadvisor \\
Henry Salvatori Professor \\
Computer and Information Sciences

\vspace*{4ex}

\noindent\makebox[0in][l]{\rule[2ex]{3.5in}{.3mm}}%
Graduate Group Chair: Val Tannen \\
Professor \\
Computer and Information Sciences

\vspace*{2ex}

\noindent Dissertation Committee \\
Rajeev Alur (Zisman Family Professor, CIS) \\
Nate Foster (Assistant Professor, Computer Science, Cornell) \\
Stephanie Weirich (Associate Professor, CIS) \\
Chaired by Steve Zdancewic (Associate Professor, CIS)
\vspace*{\fill}

\normalsize\parskip=\oldparskip


\newpage
\doublespacing

\chapter*{Acknowledgments}
% * Nate: inspiration + discussions
% * Martin: expertise, insight, unending enthusiasm
% * Benjamin: wisdom, expertise, faith, exacting standards, technical
%   writing skills
% * Steve+Stephanie: guidance and technical perspective
% * William Lamb: changed my life
% * Dad: faith+encouragement, endless discussions about broader perspective
%   and goals, comments on drafts
% * Nicole: enforcement, and loving, steadfast support
% * Mom+Dad: enforcement
% * Brent+Michael: TeX hacking and dissertation formatting
% * Brent, Peter-Michael, Vilhelm: camaraderie and brick-walling
% * Michael, Chris, Robert, Leonidas, Antal, Jen, Catalin, the rest of the
%   PL Club: fostering a warm and welcoming place to work
% * Dave Gunderson: comments
% * whole environment (family, childhood friends, teachers, professors) who
%   instilled wonder and the joy of exploration in me since forever
% * countless Internet denizens: tutorials, advice, and tips for tricking
%   TeX into doing what it should have done in the first place

\newpage
\vspace*{\fill}

\begin{center}
  ABSTRACT\\
\vspace{.5in}
\thetitle\\
\vspace{.5in}
  \theauthor\\
  \theadvisor
\end{center}

\doublespacing
\noindent

% TODO: 350 word-count limit
{\em Lenses}---bidirectional transformations between pairs of connected
structures capable of translating an edit on one structure into an edit on
the other---have been extensively studied and are beginning to find their
way into industrial practice. However, some aspects of their foundations
remain poorly understood. Most previous work has focused on the special case
of {\em asymmetric lenses}, where one of the structures is taken as primary
and the other is thought of as a projection, or view. A few studies have
considered symmetric variants, where each structure contains information not
present in the other, but these all lack the basic operation of {\em
composition}. Additionally, there is not yet a satisfactory treatment of how
edits are {\em represented}. Many foundational
accounts~\cite{Focal2005,HofmannPierceWagner10} only consider edits of the
form ``overwrite the whole structure,'' leading to poor behavior in many
situations by failing to track the associations between corresponding parts
of the structures when elements are inserted and deleted in ordered lists,
for example. Other theories of lenses do maintain these associations, either
by annotating the structures themselves with change
information~\cite{HuModels07, Hidaka10} or using auxiliary data
structures~\cite{Matching10, Diskin-Delta11}, but every extant theory
assumes that the entire original source structure is part of the information
passed to the lens. Moreover, while many domain-specific languages based on
lenses have been designed, lenses have not been thoroughly explored from an
algebraic perspective.

First, we present a new symmetric formulation, based on {\em complements},
an old idea from the database literature. This formulation generalizes the
familiar structure of asymmetric lenses, and it admits a good notion of
composition. We then generalize the symmetric formulation to work with
descriptions of changes to structures, rather than with the structures
themselves. We identify a simple notion of ``editable structure''---a set of
states plus a monoid of edits with a partial monoid action on the
states---and construct a semantic space of {\em edit lenses} between such
structures, with natural laws governing their behavior. We instantiate these
two formulations by presenting generalizations of a number of known
constructions on asymmetric lenses and settle some longstanding questions
about their properties---in particular, we prove the existence of (symmetric
monoidal) tensor products and sums and the {\em non-}existence of full
categorical products and sums in the category of symmetric lenses. The
methods of universal algebra can be applied to build symmetric {\em iterator
lenses} for structured data such as lists and trees, yielding lenses for
operations like mapping, filtering, and concatenation from first principles.
An even more general technique provides mapping combinators, based on the
theory of {\em containers} in the sense of Abbott, Altenkirch, and
Ghani~\cite{1195941}. We show that many of these constructions can also be
carried out in the framework of edit lenses. Finally, we show that edit
lenses refine symmetric lenses, in the sense that every symmetric lens gives
rise to an edit lens over structures with a simple overwrite-only edit
language, and conversely every edit lens on such structures gives rise to a
state-based lens.
% TODO: something about the implementation

\vspace*{\fill}

\newpage

\tableofcontents

\newpage

\listoftables

\listoffigures

\newpage
\singlespacing
\pagenumbering{arabic}

\chapter{Introduction}
\label{chap:introduction}
\label{chap:intro}

\input{introduction}

\chapter{Symmetric Lenses}
\label{chap:complement}
\label{chap:symmetric}
\label{chap:symmetry}
\label{chap:symm}

\input{complement}

\chapter{Edit Lenses}
\label{chap:delta}
\label{chap:edits}
\label{chap:edit}

\mlinjargs\input{delta}\mlinjnoargs

%\chapter{Hyperlenses}
%\label{chap:hyper}
%
%\input{hyper}
%
%\chapter{Tree Lenses}
%\label{chap:tree}
%
%\input{tree}

\ifimpl
\chapter{Prototype Library for Edit Lenses}
\label{chap:implementation}
\label{chap:impl}

\input{implementation}
\fi%impl

\chapter{Related Work}
\label{chap:related}

\input{related}

\chapter{Conclusion}
\label{chap:conclusion}
\label{chap:conc}

\input{conclusion}

\appendix
\chapter{Full code}
\label{app:code}
\label{app:source}
\label{chap:code}
\label{chap:source}
\footnotesize
\input{code}
\normalsize

% TODO: there's probably a required style
% TODO: references must be in alphabetical order, so double-check that
% TODO: name abbreviation style isn't consistent
\bibliographystyle{plainnat}
\bibliography{bcp,harmony,complement,delta,tree,dissertation}

\end{document}
